"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[952],{46952:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var n=t(1413),o=t(45987),i=t(49142),a=t(28182),l=t(72791),c=t(70107),r=t(16871),d=t(81724),m=t(34042),u=t(93189),p=t(91591),h=t(94970),x=t(80184);d.Ry().shape({questionText:d.Z_().required("Question text is required"),questionType:d.Z_().required("Question type is required"),sectionId:d.Z_().required("Section is required"),maxOptionsAllowed:d.Rx()});const f=e=>{let{setPageLoading:s}=e;const[t,d]=(0,l.useState)(!1),[f,b]=(0,l.useState)([]),[g,y]=(0,l.useState)([]),[j,v]=(0,l.useState)({}),[N,T]=l.useState(!1),w=(0,r.s0)(),[q,k]=(0,l.useState)({}),[Z,O]=(0,l.useState)({}),[S,Q]=(0,l.useState)(!1),[I,C]=(0,l.useState)([]),[M,E]=(0,l.useState)(""),[A,D]=(0,l.useState)(!1),[F,R]=(0,l.useState)(!1),G={questionText:"",questionType:"",maxOptionsAllowed:"",questionOptions:[""],sectionId:""},z=(e,s)=>{v(t=>{const a=t[e]||{},l=a[s];if(l&&l.checked){const{[s]:l}=a,c=(0,o.Z)(a,[s].map(i.Z));return(0,n.Z)((0,n.Z)({},t),{},{[e]:c})}return(0,n.Z)((0,n.Z)({},t),{},{[e]:(0,n.Z)((0,n.Z)({},a),{},{[s]:{checked:!0,score:0}})})})},B=()=>{L(e=>{const s=[...e.questionOptions,""];return(0,n.Z)((0,n.Z)({},e),{},{questionOptions:s})})},_=(e,s)=>{if(s){const t=new FileReader;t.onloadend=()=>{O(s=>(0,n.Z)((0,n.Z)({},s),{},{[e]:t.result}))},t.readAsDataURL(s)}else O(s=>{const t=(0,n.Z)({},s);return delete t[e],t})},[H,L]=(0,l.useState)(G);return(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,m.Bx)();b(e.data)}catch(e){b([])}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,u.rS)();y(e.data)}catch(e){y([])}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,h.WL)();C(e.data)}catch(e){C([])}})()},[]),(0,l.useEffect)(()=>{S?(L(e=>(0,n.Z)((0,n.Z)({},e),{},{questionOptions:[]})),v({}),T(!1)):E("")},[S]),(0,l.useEffect)(()=>{N||S||(L(e=>(0,n.Z)((0,n.Z)({},e),{},{questionOptions:[""]})),v({}))},[N]),(0,x.jsx)("div",{className:"container py-5",children:(0,x.jsxs)("div",{className:"card shadow-sm py-5",children:[(0,x.jsx)("div",{className:"card-header",children:(0,x.jsx)("h1",{className:"mb-0",children:"Add Assessment Question"})}),(0,x.jsxs)("form",{className:"form w-100 fv-plugins-bootstrap5 fv-plugins-framework",onSubmit:async e=>{e.preventDefault(),d(!0);try{console.log("Submitting form. optionMeasuredQualities state:",j);let e=[];e=S&&M?[{optionText:null,optionImageBase64:null,optionScores:[],correct:!1,isGame:!0,game:{gameId:Number(M)}}]:H.questionOptions.map((e,s)=>{const t="image"===q[s],n=t?null:"string"===typeof e?e:e.optionText,o=t&&Z[s]||null,i="string"!==typeof e&&(e.correct||!1),a="string"===typeof e?null:e.optionDescription||null,l=[];return j[s]&&Object.entries(j[s]).forEach(e=>{let[s,t]=e;t.checked&&l.push({score:t.score,question_option:{},measuredQualityType:{measuredQualityTypeId:Number(s)}})}),{optionText:n,optionImageBase64:o,optionScores:l,correct:i,isGame:!1,game:null,optionDescription:a}});const s={questionText:H.questionText,questionType:H.questionType,maxOptionsAllowed:Number(H.maxOptionsAllowed)||0,isMQT:A,isMQTtyped:F,options:e,section:{sectionId:Number(H.sectionId)},flag:N?1:0};console.log("Payload to submit:",s),await(0,u.Nj)(s),L(G),v({}),k({}),O({}),E(""),Q(!1),w("/assessment-questions")}catch(s){console.error("Error creating question:",s)}finally{d(!1)}},children:[(0,x.jsxs)("div",{className:"card-body",children:[(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Text:"}),(0,x.jsx)("textarea",{name:"questionText",placeholder:"Enter Question Text",rows:4,className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!H.questionText,"is-valid":!!H.questionText}),value:H.questionText,onChange:e=>L(s=>(0,n.Z)((0,n.Z)({},s),{},{questionText:e.target.value}))})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Type:"}),(0,x.jsxs)("select",{name:"questionType",className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!H.questionType,"is-valid":!!H.questionType}),value:H.questionType,onChange:e=>L(s=>(0,n.Z)((0,n.Z)({},s),{},{questionType:e.target.value})),children:[(0,x.jsx)("option",{value:"",children:"Select Question Type"}),(0,x.jsx)("option",{value:"multiple-choice",children:"Multiple Choice"}),(0,x.jsx)("option",{value:"single-choice",children:"Single Choice"}),(0,x.jsx)("option",{value:"ranking",children:"Ranking"}),(0,x.jsx)("option",{value:"text",children:"Text Input"})]})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Section"}),(0,x.jsxs)("select",{name:"sectionId",className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!H.sectionId,"is-valid":!!H.sectionId}),value:H.sectionId,onChange:e=>L(s=>(0,n.Z)((0,n.Z)({},s),{},{sectionId:e.target.value})),children:[(0,x.jsx)("option",{value:"",children:"Select Section"}),f.map(e=>(0,x.jsx)("option",{value:e.sectionId,children:e.sectionName},e.sectionId))]})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Options:"}),S?(0,x.jsxs)("div",{className:"p-3 border rounded bg-light",children:[(0,x.jsx)("div",{className:"d-flex align-items-center mb-2",children:(0,x.jsx)("span",{className:"me-2 fw-bold",children:"\ud83c\udfae Select Game:"})}),(0,x.jsxs)("select",{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!M,"is-valid":!!M}),value:M,onChange:e=>E(e.target.value),children:[(0,x.jsx)("option",{value:"",children:"Select a Game"}),I.map(e=>(0,x.jsxs)("option",{value:e.gameId,children:[e.gameName," (Code: ",e.gameCode,")"]},e.gameId))]}),M&&(0,x.jsx)("div",{className:"mt-2 text-success",children:"\u2705 Game selected. This question will launch the selected game as an option."})]}):N?(0,x.jsx)(p.O,{mqt:g,formikValues:H,setFormikValues:L}):H.questionOptions.map((e,s)=>{const t="string"===typeof e?e:e.optionText,o="image"===q[s];return(0,x.jsxs)("div",{className:"mb-3 p-3 border rounded bg-light",children:[(0,x.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,x.jsxs)("span",{className:"me-2 fw-bold",children:["Option ",s+1,":"]}),(0,x.jsxs)("div",{className:"form-check form-switch ms-auto",children:[(0,x.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"option-type-switch-".concat(s),checked:o,onChange:()=>(e=>{k(s=>(0,n.Z)((0,n.Z)({},s),{},{[e]:"image"===s[e]?"text":"image"}))})(s)}),(0,x.jsx)("label",{className:"form-check-label",htmlFor:"option-type-switch-".concat(s),children:o?"\ud83d\udcf7 Image":"\ud83d\udcdd Text"})]})]}),(0,x.jsxs)("div",{className:"d-flex align-items-start gap-2",children:[o?(0,x.jsxs)("div",{className:"flex-grow-1",children:[(0,x.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return _(s,(null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"form-control form-control-sm mb-2"}),Z[s]&&(0,x.jsxs)("div",{className:"position-relative d-inline-block",children:[(0,x.jsx)("img",{src:Z[s],alt:"Option ".concat(s+1),style:{maxWidth:150,maxHeight:100,objectFit:"cover",borderRadius:4,border:"1px solid #ddd"}}),(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 8px",fontSize:12},onClick:()=>_(s,null),children:"\xd7"})]})]}):(0,x.jsx)("input",{type:"text",placeholder:"Enter option ".concat(s+1),value:t,onChange:e=>((e,s)=>{L(t=>{const o=[...t.questionOptions];return"string"===typeof o[e]?o[e]=s:o[e]=(0,n.Z)((0,n.Z)({},o[e]),{},{optionText:s}),(0,n.Z)((0,n.Z)({},t),{},{questionOptions:o})})})(s,e.target.value),className:(0,a.default)("form-control form-control-lg form-control-solid flex-grow-1",{"is-invalid text-danger":!t,"is-valid":!!t})}),(0,x.jsxs)(c.Z,{children:[(0,x.jsx)(c.Z.Toggle,{variant:"secondary",id:"dropdown-option-".concat(s),size:"sm",children:"MQT"}),(0,x.jsxs)(c.Z.Menu,{style:{minWidth:250},children:[(0,x.jsx)(c.Z.Header,{children:"Measured Quality Types"}),(0,x.jsx)("div",{style:{maxHeight:250,overflowY:"auto",padding:8},children:g.map((e,t)=>{var o,i,a,l,c,r;return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,x.jsx)("input",{type:"checkbox",checked:!(null===(o=j[s])||void 0===o||null===(i=o[e.measuredQualityTypeId])||void 0===i||!i.checked),onChange:()=>z(s,e.measuredQualityTypeId),className:"form-check-input me-2",id:"option-".concat(s,"-type-").concat(e.measuredQualityTypeId)}),(0,x.jsx)("label",{htmlFor:"option-".concat(s,"-type-").concat(e.measuredQualityTypeId),className:"me-2 mb-0",children:e.measuredQualityTypeName}),!(null===(a=j[s])||void 0===a||null===(l=a[e.measuredQualityTypeId])||void 0===l||!l.checked)&&(0,x.jsx)("input",{type:"number",min:0,max:100,value:null!==(c=null===(r=j[s][e.measuredQualityTypeId])||void 0===r?void 0:r.score)&&void 0!==c?c:0,onChange:t=>{return o=s,i=e.measuredQualityTypeId,a=Number(t.target.value),void v(e=>(0,n.Z)((0,n.Z)({},e),{},{[o]:(0,n.Z)((0,n.Z)({},e[o]),{},{[i]:{checked:!0,score:a}})}));var o,i,a},placeholder:"Score",className:"form-control form-control-sm ms-2",style:{width:70}})]}),t<g.length-1&&(0,x.jsx)("hr",{style:{margin:"4px 0"}})]},e.measuredQualityTypeId)})})]})]}),j[s]&&Object.keys(j[s]).length>0&&(0,x.jsxs)("div",{className:"mt-2",style:{width:"100%"},children:[(0,x.jsx)("div",{className:"small text-muted mb-1",children:"Selected:"}),(0,x.jsx)("div",{className:"d-flex flex-wrap gap-1",children:Object.entries(j[s]).filter(e=>{let[s,t]=e;return t.checked}).map(e=>{let[t,n]=e;const o=g.find(e=>e.measuredQualityTypeId===Number(t));return o?(0,x.jsxs)("div",{className:"badge bg-primary d-flex align-items-center gap-1",style:{fontSize:"0.75rem",padding:"0.35rem 0.5rem"},children:[(0,x.jsx)("span",{children:o.measuredQualityTypeName}),(0,x.jsx)("span",{className:"badge bg-light text-dark ms-1",children:n.score}),(0,x.jsx)("button",{type:"button",className:"btn-close btn-close-white",style:{fontSize:"0.5rem",padding:0,width:"0.6rem",height:"0.6rem"},onClick:()=>z(s,Number(t)),"aria-label":"Remove"})]},t):null})})]}),H.questionOptions.length>1&&(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>(e=>{L(s=>{const t=s.questionOptions.filter((s,t)=>t!==e);return v(s=>{const t={};return Object.keys(s).forEach(n=>{const o=Number(n);o<e?t[o]=s[o]:o>e&&(t[o-1]=s[o])}),t}),k(s=>{const t={};return Object.keys(s).forEach(n=>{const o=Number(n);o<e?t[o]=s[o]:o>e&&(t[o-1]=s[o])}),t}),O(s=>{const t={};return Object.keys(s).forEach(n=>{const o=Number(n);o<e?t[o]=s[o]:o>e&&(t[o-1]=s[o])}),t}),(0,n.Z)((0,n.Z)({},s),{},{questionOptions:t})})})(s),children:"-"}),s===H.questionOptions.length-1&&(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-primary",onClick:B,children:"+"})]}),(0,x.jsxs)("div",{className:"mt-2",children:[(0,x.jsx)("label",{className:"fs-7 fw-semibold mb-1 text-muted",children:"Option Description:"}),(0,x.jsx)("textarea",{className:"form-control form-control-sm",rows:2,placeholder:"Enter description for this option (optional)",value:("string"===typeof e?"":e.optionDescription)||"",onChange:e=>((e,s)=>{L(t=>{const o=[...t.questionOptions],i=o[e];return o[e]="string"===typeof i?{optionText:i,optionDescription:s}:(0,n.Z)((0,n.Z)({},i),{},{optionDescription:s}),(0,n.Z)((0,n.Z)({},t),{},{questionOptions:o})})})(s,e.target.value)})]})]},s)})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"fs-6 fw-bold mb-2",children:"text"===H.questionType?"Number of Text Input Boxes":"Max Options Allowed"}),(0,x.jsx)("input",{type:"number",min:0,max:100,value:H.maxOptionsAllowed,onChange:e=>L(s=>(0,n.Z)((0,n.Z)({},s),{},{maxOptionsAllowed:e.target.value})),placeholder:"text"===H.questionType?"Number of text input boxes":"Max Options Allowed",className:"form-control form-control-lg form-control-solid w-25",style:{width:200}})]}),"text"===H.questionType&&(0,x.jsxs)("div",{className:"alert alert-info mb-7",children:[(0,x.jsx)("strong",{children:"Text Input Mode:"})," Students will type free-text answers instead of selecting options. The options below serve as reference options for autocomplete suggestions and scoring after admin mapping."]}),(0,x.jsxs)("div",{className:"fv-row mb-7 d-flex gap-5",children:[(0,x.jsxs)("div",{className:"form-check form-switch",children:[(0,x.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"isMQTToggle",checked:A,onChange:()=>D(e=>!e)}),(0,x.jsx)("label",{className:"form-check-label fs-6 fw-bold",htmlFor:"isMQTToggle",children:"isMQT"})]}),(0,x.jsxs)("div",{className:"form-check form-switch",children:[(0,x.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"isMQTtypedToggle",checked:F,onChange:()=>R(e=>!e)}),(0,x.jsx)("label",{className:"form-check-label fs-6 fw-bold",htmlFor:"isMQTtypedToggle",children:"isMQTtyped"})]})]}),(0,x.jsxs)("div",{className:"mb-4 d-flex gap-4",children:[(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:N,onChange:()=>{T(e=>!e),N||Q(!1)},className:"me-2",disabled:S}),"Use Measured Quality Types as Options"]}),(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:S,onChange:()=>{Q(e=>!e),S||T(!1)},className:"me-2",disabled:N}),"\ud83c\udfae Use Game as Option"]})]})]}),(0,x.jsxs)("div",{className:"card-footer d-flex justify-content-end",children:[(0,x.jsx)("button",{type:"button",className:"btn btn-light me-2",onClick:()=>w("/assessment-questions"),children:"Cancel"}),(0,x.jsxs)("button",{type:"submit",className:"btn btn-primary",disabled:t,children:[!t&&(0,x.jsx)("span",{className:"indicator-label",children:"Submit"}),t&&(0,x.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait..."," ",(0,x.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})]})})}}}]);
//# sourceMappingURL=952.fa65145c.chunk.js.map