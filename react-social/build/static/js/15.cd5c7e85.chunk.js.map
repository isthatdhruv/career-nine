{"version":3,"file":"static/js/15.cd5c7e85.chunk.js","mappings":"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","sources":["app/pages/TextResponseMapping/API/TextResponseMapping_APIs.ts","app/pages/TextResponseMapping/TextResponseMappingPage.tsx"],"sourcesContent":["import axios from \"axios\";\nconst API_URL = process.env.REACT_APP_API_URL;\n\nexport function GetTextResponses(assessmentId: number) {\n  return axios.get(`${API_URL}/assessment-answer/text-responses/${assessmentId}`);\n}\n\nexport function MapTextResponse(assessmentAnswerId: number, optionId: number) {\n  return axios.put(`${API_URL}/assessment-answer/map-text-response`, {\n    assessmentAnswerId,\n    optionId,\n  });\n}\n\nexport function RecalculateScores(assessmentId: number) {\n  return axios.post(`${API_URL}/assessment-answer/recalculate-scores/${assessmentId}`);\n}\n\nexport function GetAssessmentList() {\n  return axios.get(`${API_URL}/assessments/get/list`);\n}\n","import React, { useEffect, useState } from \"react\";\nimport {\n  GetTextResponses,\n  MapTextResponse,\n  RecalculateScores,\n  GetAssessmentList,\n} from \"./API/TextResponseMapping_APIs\";\nimport { matchTextToOption, matchTextToOptionsBulk } from \"../AssesmentQuestions/API/Translate_APIs\";\n\ninterface OptionRef {\n  optionId: number;\n  optionText: string;\n}\n\ninterface TextResponseItem {\n  assessmentAnswerId: number;\n  assessmentAnswerIds: number[];\n  textResponse: string;\n  count: number;\n  student: { userStudentId: number; userId: number } | null;\n  question: {\n    questionId: number;\n    questionText: string;\n    questionnaireQuestionId: number;\n    options: OptionRef[];\n  } | null;\n  mappedOption: OptionRef | null;\n}\n\ninterface Assessment {\n  id: number;\n  assessmentName: string;\n}\n\nconst TextResponseMappingPage: React.FC = () => {\n  const [assessments, setAssessments] = useState<Assessment[]>([]);\n  const [selectedAssessmentId, setSelectedAssessmentId] = useState<number | null>(null);\n  const [textResponses, setTextResponses] = useState<TextResponseItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [mappingState, setMappingState] = useState<Record<number, number | \"\">>({});\n  const [savingIds, setSavingIds] = useState<Set<number>>(new Set());\n  const [aiLoadingIds, setAiLoadingIds] = useState<Set<number>>(new Set());\n  const [bulkAiLoading, setBulkAiLoading] = useState(false);\n  const [recalculating, setRecalculating] = useState(false);\n  const [message, setMessage] = useState<{ type: \"success\" | \"danger\"; text: string } | null>(null);\n\n  // Load assessments on mount\n  useEffect(() => {\n    GetAssessmentList()\n      .then((res) => {\n        setAssessments(res.data || []);\n      })\n      .catch((err) => console.error(\"Failed to load assessments:\", err));\n  }, []);\n\n  // Load text responses when assessment changes\n  useEffect(() => {\n    if (!selectedAssessmentId) {\n      setTextResponses([]);\n      return;\n    }\n    setLoading(true);\n    GetTextResponses(selectedAssessmentId)\n      .then((res) => {\n        const data: TextResponseItem[] = res.data || [];\n        setTextResponses(data);\n        // Initialize mapping state from existing mappings\n        const initial: Record<number, number | \"\"> = {};\n        for (const item of data) {\n          initial[item.assessmentAnswerId] = item.mappedOption?.optionId || \"\";\n        }\n        setMappingState(initial);\n      })\n      .catch((err) => {\n        console.error(\"Failed to load text responses:\", err);\n        setMessage({ type: \"danger\", text: \"Failed to load text responses.\" });\n      })\n      .finally(() => setLoading(false));\n  }, [selectedAssessmentId]);\n\n  const handleMapSingle = async (assessmentAnswerId: number) => {\n    const optionId = mappingState[assessmentAnswerId];\n    if (!optionId) return;\n\n    setSavingIds((prev) => new Set(prev).add(assessmentAnswerId));\n    try {\n      await MapTextResponse(assessmentAnswerId, optionId as number);\n      // Update local state\n      setTextResponses((prev) =>\n        prev.map((item) => {\n          if (item.assessmentAnswerId === assessmentAnswerId) {\n            const opt = item.question?.options.find((o) => o.optionId === optionId);\n            return { ...item, mappedOption: opt || null };\n          }\n          return item;\n        })\n      );\n      setMessage({ type: \"success\", text: \"Mapping saved successfully.\" });\n    } catch (err) {\n      console.error(\"Failed to map:\", err);\n      setMessage({ type: \"danger\", text: \"Failed to save mapping.\" });\n    } finally {\n      setSavingIds((prev) => {\n        const s = new Set(prev);\n        s.delete(assessmentAnswerId);\n        return s;\n      });\n    }\n  };\n\n  const handleAiSuggest = async (item: TextResponseItem) => {\n    if (!item.question?.options?.length) return;\n\n    setAiLoadingIds((prev) => new Set(prev).add(item.assessmentAnswerId));\n    try {\n      const result = await matchTextToOption(item.textResponse, item.question.options);\n      if (result.matchedOptionId) {\n        setMappingState((prev) => ({\n          ...prev,\n          [item.assessmentAnswerId]: result.matchedOptionId,\n        }));\n      }\n      setMessage({\n        type: result.matchedOptionId ? \"success\" : \"danger\",\n        text: result.matchedOptionId\n          ? `AI suggests: \"${result.matchedOptionText}\" â€” ${result.reason || \"\"}`\n          : \"AI could not find a reasonable match.\",\n      });\n    } catch (err) {\n      console.error(\"AI matching failed:\", err);\n      setMessage({ type: \"danger\", text: \"AI matching failed.\" });\n    } finally {\n      setAiLoadingIds((prev) => {\n        const s = new Set(prev);\n        s.delete(item.assessmentAnswerId);\n        return s;\n      });\n    }\n  };\n\n  const handleBulkAiMap = async () => {\n    // Get all unmapped responses\n    const unmapped = textResponses.filter(\n      (item) => !mappingState[item.assessmentAnswerId] && item.question?.options?.length\n    );\n    if (unmapped.length === 0) {\n      setMessage({ type: \"danger\", text: \"No unmapped responses to process.\" });\n      return;\n    }\n\n    setBulkAiLoading(true);\n    try {\n      const responses = unmapped.map((item) => ({\n        textResponse: item.textResponse,\n        options: item.question!.options,\n      }));\n      const result = await matchTextToOptionsBulk(responses);\n\n      if (result.results) {\n        const newState = { ...mappingState };\n        for (let i = 0; i < unmapped.length; i++) {\n          const match = result.results[i];\n          if (match.matchedOptionId) {\n            newState[unmapped[i].assessmentAnswerId] = match.matchedOptionId;\n          }\n        }\n        setMappingState(newState);\n        const matched = result.results.filter((r: any) => r.matchedOptionId).length;\n        setMessage({\n          type: \"success\",\n          text: `AI mapped ${matched} of ${unmapped.length} responses. Review and save each mapping.`,\n        });\n      }\n    } catch (err) {\n      console.error(\"Bulk AI matching failed:\", err);\n      setMessage({ type: \"danger\", text: \"Bulk AI matching failed.\" });\n    } finally {\n      setBulkAiLoading(false);\n    }\n  };\n\n  const handleRecalculateScores = async () => {\n    if (!selectedAssessmentId) return;\n    setRecalculating(true);\n    try {\n      const res = await RecalculateScores(selectedAssessmentId);\n      const data = res.data;\n      setMessage({\n        type: \"success\",\n        text: `Scores recalculated for ${data.studentsProcessed} students.`,\n      });\n    } catch (err) {\n      console.error(\"Recalculation failed:\", err);\n      setMessage({ type: \"danger\", text: \"Score recalculation failed.\" });\n    } finally {\n      setRecalculating(false);\n    }\n  };\n\n  const unmappedCount = textResponses.filter((item) => !item.mappedOption && !mappingState[item.assessmentAnswerId]).length;\n  const totalCount = textResponses.length;\n\n  return (\n    <div className=\"card\">\n      <div className=\"card-header border-0 pt-6\">\n        <div className=\"card-title\">\n          <h3 className=\"fw-bolder m-0\">Text Response Mapping</h3>\n        </div>\n      </div>\n      <div className=\"card-body py-4\">\n        {message && (\n          <div className={`alert alert-${message.type} alert-dismissible fade show`} role=\"alert\">\n            {message.text}\n            <button type=\"button\" className=\"btn-close\" onClick={() => setMessage(null)}></button>\n          </div>\n        )}\n\n        {/* Assessment Selector */}\n        <div className=\"row mb-5\">\n          <div className=\"col-md-4\">\n            <label className=\"fs-6 fw-bold mb-2\">Select Assessment</label>\n            <select\n              className=\"form-select form-select-solid\"\n              value={selectedAssessmentId || \"\"}\n              onChange={(e) => setSelectedAssessmentId(e.target.value ? Number(e.target.value) : null)}\n            >\n              <option value=\"\">-- Select Assessment --</option>\n              {assessments.map((a) => (\n                <option key={a.id} value={a.id}>\n                  {a.assessmentName}\n                </option>\n              ))}\n            </select>\n          </div>\n          {selectedAssessmentId && textResponses.length > 0 && (\n            <div className=\"col-md-8 d-flex align-items-end gap-3\">\n              <button\n                className=\"btn btn-info\"\n                onClick={handleBulkAiMap}\n                disabled={bulkAiLoading || unmappedCount === 0}\n              >\n                {bulkAiLoading ? (\n                  <><span className=\"spinner-border spinner-border-sm me-2\"></span>AI Processing...</>\n                ) : (\n                  <>AI Auto-Map Unmapped ({unmappedCount})</>\n                )}\n              </button>\n              <button\n                className=\"btn btn-success\"\n                onClick={handleRecalculateScores}\n                disabled={recalculating}\n              >\n                {recalculating ? (\n                  <><span className=\"spinner-border spinner-border-sm me-2\"></span>Recalculating...</>\n                ) : (\n                  \"Recalculate Scores\"\n                )}\n              </button>\n              <span className=\"badge bg-secondary fs-7 p-3\">\n                {totalCount} responses, {unmappedCount} unmapped\n              </span>\n            </div>\n          )}\n        </div>\n\n        {/* Text Responses Table */}\n        {loading ? (\n          <div className=\"text-center py-10\">\n            <span className=\"spinner-border spinner-border-lg\"></span>\n            <p className=\"mt-3\">Loading text responses...</p>\n          </div>\n        ) : !selectedAssessmentId ? (\n          <div className=\"text-center py-10 text-muted\">\n            <p className=\"fs-5\">Select an assessment to view text responses.</p>\n          </div>\n        ) : textResponses.length === 0 ? (\n          <div className=\"text-center py-10 text-muted\">\n            <p className=\"fs-5\">No text responses found for this assessment.</p>\n          </div>\n        ) : (\n          <div className=\"table-responsive\">\n            <table className=\"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3\">\n              <thead>\n                <tr className=\"fw-bolder text-muted\">\n                  <th className=\"min-w-200px\">Question</th>\n                  <th className=\"min-w-150px\">Text Response</th>\n                  <th className=\"min-w-50px\">Count</th>\n                  <th className=\"min-w-200px\">Map to Option</th>\n                  <th className=\"min-w-50px\">Status</th>\n                  <th className=\"min-w-150px text-end\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {textResponses.map((item) => {\n                  const currentMapping = mappingState[item.assessmentAnswerId];\n                  const isSaved = item.mappedOption?.optionId === currentMapping;\n                  const isSaving = savingIds.has(item.assessmentAnswerId);\n                  const isAiLoading = aiLoadingIds.has(item.assessmentAnswerId);\n\n                  return (\n                    <tr key={item.assessmentAnswerId}>\n                      <td>\n                        <span className=\"text-dark d-block fs-7\" style={{ maxWidth: 300, overflow: \"hidden\", textOverflow: \"ellipsis\", whiteSpace: \"nowrap\" }}>\n                          {item.question?.questionText || \"N/A\"}\n                        </span>\n                      </td>\n                      <td>\n                        <span className=\"badge bg-light-primary text-primary fs-7 p-2\">\n                          {item.textResponse}\n                        </span>\n                      </td>\n                      <td>\n                        <span className=\"badge bg-secondary fs-7\">{item.count || 1}</span>\n                      </td>\n                      <td>\n                        <select\n                          className=\"form-select form-select-sm\"\n                          value={currentMapping || \"\"}\n                          onChange={(e) =>\n                            setMappingState((prev) => ({\n                              ...prev,\n                              [item.assessmentAnswerId]: e.target.value ? Number(e.target.value) : \"\",\n                            }))\n                          }\n                        >\n                          <option value=\"\">-- Select Option --</option>\n                          {item.question?.options.map((opt) => (\n                            <option key={opt.optionId} value={opt.optionId}>\n                              {opt.optionText}\n                            </option>\n                          ))}\n                        </select>\n                      </td>\n                      <td>\n                        {item.mappedOption ? (\n                          <span className=\"badge bg-success\">Mapped</span>\n                        ) : currentMapping ? (\n                          <span className=\"badge bg-warning text-dark\">Unsaved</span>\n                        ) : (\n                          <span className=\"badge bg-danger\">Unmapped</span>\n                        )}\n                      </td>\n                      <td className=\"text-end\">\n                        <button\n                          className=\"btn btn-sm btn-light-info me-2\"\n                          onClick={() => handleAiSuggest(item)}\n                          disabled={isAiLoading || !item.question?.options?.length}\n                          title=\"AI Suggest\"\n                        >\n                          {isAiLoading ? (\n                            <span className=\"spinner-border spinner-border-sm\"></span>\n                          ) : (\n                            \"AI Suggest\"\n                          )}\n                        </button>\n                        <button\n                          className=\"btn btn-sm btn-light-success\"\n                          onClick={() => handleMapSingle(item.assessmentAnswerId)}\n                          disabled={!currentMapping || isSaving || isSaved}\n                        >\n                          {isSaving ? (\n                            <span className=\"spinner-border spinner-border-sm\"></span>\n                          ) : isSaved ? (\n                            \"Saved\"\n                          ) : (\n                            \"Save\"\n                          )}\n                        </button>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TextResponseMappingPage;\n"],"names":["API_URL","process","TextResponseMappingPage","assessments","setAssessments","useState","selectedAssessmentId","setSelectedAssessmentId","textResponses","setTextResponses","loading","setLoading","mappingState","setMappingState","savingIds","setSavingIds","Set","aiLoadingIds","setAiLoadingIds","bulkAiLoading","setBulkAiLoading","recalculating","setRecalculating","message","setMessage","useEffect","axios","concat","then","res","data","catch","err","console","error","assessmentId","initial","item","_item$mappedOption","assessmentAnswerId","mappedOption","optionId","type","text","finally","handleMapSingle","async","prev","add","MapTextResponse","map","_item$question","opt","question","options","find","o","_objectSpread","s","delete","unmappedCount","filter","length","totalCount","_jsxs","className","children","_jsx","role","onClick","value","onChange","e","target","Number","a","id","assessmentName","unmapped","_item$question3","_item$question3$optio","responses","textResponse","result","matchTextToOptionsBulk","results","newState","i","match","matchedOptionId","matched","r","disabled","_Fragment","studentsProcessed","_item$mappedOption2","_item$question4","_item$question5","_item$question6","_item$question6$optio","currentMapping","isSaved","isSaving","has","isAiLoading","style","maxWidth","overflow","textOverflow","whiteSpace","questionText","count","optionText","_item$question2","_item$question2$optio","matchTextToOption","matchedOptionText","reason","handleAiSuggest","title"],"sourceRoot":""}