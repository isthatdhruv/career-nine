"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[95,94],{15110:(e,s,t)=>{t.d(s,{Kk:()=>o,Pm:()=>l,XM:()=>d,bR:()=>c,eF:()=>m,zV:()=>u,zW:()=>r});var n=t(74569),a=t.n(n);const i="https://api.career-9.com";function l(e){return a().post("".concat(i,"/assessment-mapping/create"),e)}function o(e){return a().get("".concat(i,"/assessment-mapping/getByInstitute/").concat(e))}function d(e,s){return a().put("".concat(i,"/assessment-mapping/update/").concat(e),s)}function r(e){return a().delete("".concat(i,"/assessment-mapping/delete/").concat(e))}function c(){return a().get("".concat(i,"/assessments/get/list-summary"))}function m(e){return a().get("".concat(i,"/assessment-mapping/public/info/").concat(e))}function u(e,s){return a().post("".concat(i,"/assessment-mapping/public/register/").concat(e),s)}},38095:(e,s,t)=>{t.r(s),t.d(s,{default:()=>K});var n=t(72791),a=t(16871),i=t(43360),l=t(89983),o=t(16856),d=t(54624),r=t(575),c=t(17137),m=t(78820),u=t(43504),x=t(70099),h=t(10120),p=t(70107),b=t(62094),g=t(1413),v=t(28403),j=t(7755),N=t(43677),f=t(51304),y=t(80184);const w=e=>{var s;const[t,a]=(0,n.useState)(!1),[i,l]=(0,n.useState)([]),[o,r]=(0,n.useState)([]),[c,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[w,C]=(0,n.useState)(!1),[k,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{var s,t,n;if(!e.show)return;const a=null===(s=e.data)||void 0===s?void 0:s.instituteCode;if((async()=>{try{var e,s,t,n,i,o,c,m,u,x,p,g,v,j;const[y,w,C]=await Promise.all([(0,f.Fk)(),(0,N.AF)(),a?(0,d.XP)(a).catch(()=>null):Promise.resolve(null)]),k=(null!==(e=null!==(s=null!==(t=null===y||void 0===y||null===(n=y.data)||void 0===n?void 0:n.data)&&void 0!==t?t:null===y||void 0===y||null===(i=y.data)||void 0===i?void 0:i.contacts)&&void 0!==s?s:null===y||void 0===y?void 0:y.data)&&void 0!==e?e:[]).filter(e=>e&&(e.name||e.email||e.phone||e.designation));l(k);const S=(null!==(o=null!==(c=null!==(m=null===w||void 0===w||null===(u=w.data)||void 0===u?void 0:u.data)&&void 0!==m?m:null===w||void 0===w||null===(x=w.data)||void 0===x?void 0:x.boards)&&void 0!==c?c:null===w||void 0===w?void 0:w.data)&&void 0!==o?o:[]).filter(e=>e&&("string"===typeof e.boardName||"string"===typeof e.name||"undefined"!==typeof e.id));h(S);const I=null!==(p=null===C||void 0===C||null===(g=C.data)||void 0===g?void 0:g.contactPersons)&&void 0!==p?p:[],Z=null!==(v=null===C||void 0===C||null===(j=C.data)||void 0===j?void 0:j.boards)&&void 0!==v?v:[],P=[];k.forEach((e,s)=>{I.find(s=>s.id&&e.id&&String(s.id)===String(e.id)||s.email&&e.email&&s.email===e.email)&&P.push(s)}),r(P);const E=[];S.forEach((e,s)=>{Z.find(s=>void 0!==s.id&&void 0!==e.id&&String(s.id)===String(e.id))&&E.push(s)}),b(E)}catch(y){console.error("Failed to load data:",y),l([]),h([]),r([]),b([])}})(),void 0!==(null===(t=e.data)||void 0===t?void 0:t.maxClass)&&null!==(null===(n=e.data)||void 0===n?void 0:n.maxClass)){const s=Number(e.data.maxClass);!isNaN(s)&&s>=1&&s<=12?S(s):S(null)}else S(null)},[e.show,e.data]);const I=e=>o.includes(e),Z=e=>p.includes(e),P=e=>{var s,t;return null!==(s=null!==(t=e.boardName)&&void 0!==t?t:e.name)&&void 0!==s?s:void 0!==e.id?String(e.id):"Board"},E=o.map(e=>i[e]),A=p.map(e=>u[e]),F=o.length>0;return(0,y.jsxs)(v.Z,{show:e.show,onHide:()=>e.onHide(),centered:!0,className:"college-modal","aria-labelledby":"college-info-modal-title",children:[(0,y.jsxs)(v.Z.Header,{className:"border-0 pb-0",children:[(0,y.jsxs)("div",{className:"d-flex flex-column",children:[(0,y.jsx)("h3",{id:"college-info-modal-title",className:"mb-1 fw-bold",children:"Map Board & Contact Person(s)"}),(0,y.jsx)("span",{className:"text-muted small",children:"Link the institute with appropriate contact person(s), board(s) and max class."})]}),(0,y.jsx)("div",{className:"btn btn-sm btn-icon btn-light ms-3",onClick:()=>e.onHide(),style:{cursor:"pointer"},children:(0,y.jsx)(x.Z,{animation:j.Z,size:24,strokeColor:"#181C32",reverse:!0})})]}),(0,y.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!e.data||!e.data.instituteCode)return void e.onHide();const t=o.map(e=>{var s;return null===(s=i[e])||void 0===s?void 0:s.id}).filter(e=>void 0!==e).map(e=>Number(e)),n=p.map(e=>{var s;return null===(s=u[e])||void 0===s?void 0:s.id}).filter(e=>void 0!==e).map(e=>Number(e));a(!0);try{await(0,d.Jp)(e.data.instituteCode,t,n),null!==k&&await(0,d.J6)((0,g.Z)((0,g.Z)({},e.data),{},{maxClass:k})),e.setPageLoading(["true"]),e.onHide(!1)}catch(l){console.error("Mapping failed",l),window.location.replace("/error")}finally{a(!1)}},className:"form w-100",children:[(0,y.jsx)(v.Z.Body,{className:"pt-3",children:(0,y.jsxs)("div",{className:"d-flex flex-column gap-4",children:[(0,y.jsx)("div",{className:"card shadow-sm border-0",children:(0,y.jsxs)("div",{className:"card-body",children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"badge bg-light text-dark mb-1",children:"Step 1"}),(0,y.jsx)("h5",{className:"mb-0",children:"Select Contact Person(s)"}),(0,y.jsx)("small",{className:"text-muted",children:"Choose one or more contact persons associated with this institute."})]}),i.length>0&&(0,y.jsxs)("span",{className:"badge bg-success-subtle text-success",children:[o.length," selected"]})]}),(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsxs)("button",{type:"button",className:"btn btn-outline-success dropdown-toggle d-flex align-items-center px-3 py-2",onClick:()=>m(e=>!e),children:[(0,y.jsx)("span",{className:"me-2",children:"\ud83d\udc64"}),(0,y.jsx)("span",{children:o.length>0?"Edit selected contact person(s)":"Select contact person(s)"})]}),(0,y.jsx)("div",{className:"dropdown-menu mt-2 shadow-sm border-0 ".concat(c?"show":""),style:{maxHeight:"260px",overflowY:"auto",minWidth:"320px"},children:0===i.length?(0,y.jsx)("span",{className:"dropdown-item-text text-muted fst-italic",children:"No contact persons found."}):i.map((e,s)=>{var t;const n=(e.name||"").split(" ").map(e=>e[0]).join("").toUpperCase()||"?";return(0,y.jsxs)("label",{className:"dropdown-item d-flex align-items-start py-2",style:{cursor:"pointer"},children:[(0,y.jsx)("input",{type:"checkbox",className:"form-check-input me-3 mt-1",checked:I(s),onChange:()=>(e=>{r(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s)}),(0,y.jsxs)("div",{className:"d-flex align-items-start w-100",children:[(0,y.jsx)("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:32,height:32,background:"#eef3ff",fontSize:13,fontWeight:600},children:n}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"fw-semibold",children:e.name||"Unnamed Contact"}),(0,y.jsxs)("div",{className:"text-muted small",children:[e.email&&(0,y.jsx)("span",{children:e.email}),e.phone&&(0,y.jsxs)("span",{children:[" ",e.email?" \u2022 ":"",e.phone]})]}),(e.gender||e.designation)&&(0,y.jsx)("div",{className:"small text-muted",children:[e.gender,e.designation].filter(Boolean).join(" \u2022 ")})]})]})]},null!==(t=e.id)&&void 0!==t?t:"".concat(e.email,"-").concat(s))})})]}),E.length>0&&(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-muted small mb-1",children:"Selected contact(s):"}),(0,y.jsx)("div",{className:"d-flex flex-wrap gap-2",children:E.map((e,s)=>{var t;return(0,y.jsxs)("span",{className:"badge bg-light text-dark border",children:[e.name||"Unnamed Contact",e.designation&&(0,y.jsxs)("span",{className:"text-muted ms-1 small",children:["(",e.designation,")"]})]},null!==(t=e.id)&&void 0!==t?t:"".concat(e.email,"-chip-").concat(s))})})]})]})}),(0,y.jsx)("div",{className:"card shadow-sm border-0 ".concat(F?"":"opacity-75"),children:(0,y.jsxs)("div",{className:"card-body",children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"badge bg-light text-dark mb-1",children:"Step 2"}),(0,y.jsx)("h5",{className:"mb-0",children:"Select Board(s)"}),(0,y.jsxs)("small",{className:"text-muted",children:["Map this institute to one or more education boards.",!F&&(0,y.jsx)("span",{className:"text-danger ms-1",children:"(Select at least one contact person in Step 1 first)"})]})]}),u.length>0&&F&&(0,y.jsxs)("span",{className:"badge bg-primary-subtle text-primary",children:[p.length," selected"]})]}),(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsxs)("button",{type:"button",className:"btn btn-outline-primary dropdown-toggle d-flex align-items-center px-3 py-2",onClick:()=>{F&&C(e=>!e)},disabled:!F,children:[(0,y.jsx)("span",{className:"me-2",children:"\ud83d\udccb"}),(0,y.jsx)("span",{children:p.length>0?"Edit selected board(s)":"Select board(s)"})]}),(0,y.jsx)("div",{className:"dropdown-menu mt-2 shadow-sm border-0 ".concat(w&&F?"show":""),style:{maxHeight:"260px",overflowY:"auto",minWidth:"260px"},children:F?0===u.length?(0,y.jsx)("span",{className:"dropdown-item-text text-muted fst-italic",children:"No boards found."}):u.map((e,s)=>{const t=P(e);return(0,y.jsxs)("label",{className:"dropdown-item d-flex align-items-center py-2",style:{cursor:"pointer"},children:[(0,y.jsx)("input",{type:"checkbox",className:"form-check-input me-3",checked:Z(s),onChange:()=>(e=>{b(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s)}),(0,y.jsx)("span",{className:"fw-semibold",children:t})]},"".concat(t,"-").concat(s))}):(0,y.jsx)("span",{className:"dropdown-item-text text-muted fst-italic",children:"Please select contact person(s) in Step 1 first."})})]}),F&&A.length>0&&(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-muted small mb-1",children:"Selected board(s):"}),(0,y.jsx)("div",{className:"d-flex flex-wrap gap-2",children:A.map((e,s)=>(0,y.jsx)("span",{className:"badge bg-light text-dark border",children:P(e)},"".concat(P(e),"-chip-").concat(s)))})]})]})})]})}),(0,y.jsx)(v.Z.Footer,{className:"border-0 pt-0",children:(0,y.jsxs)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[(0,y.jsx)("div",{className:"text-muted small",children:(null===(s=e.data)||void 0===s?void 0:s.instituteCode)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{className:"fw-semibold",children:"Institute Code: "}),(0,y.jsx)("span",{children:e.data.instituteCode})]})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-light me-2",onClick:()=>e.onHide(),disabled:t,children:"Cancel"}),(0,y.jsxs)("button",{type:"submit",className:"btn btn-sm btn-primary",disabled:t||0===i.length&&0===u.length,children:[!t&&(0,y.jsx)("span",{className:"indicator-label",children:"Save Selection"}),t&&(0,y.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait...",(0,y.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})})]})]})};var C=t(94552);const k=["Principal","Administrator","Coordinator","Teacher","Accountant","Counselor"],S=e=>{var s;const[t,a]=(0,n.useState)(!1),[i,l]=(0,n.useState)([]),[o,r]=(0,n.useState)([]),[c,m]=(0,n.useState)({}),[u,h]=(0,n.useState)({}),[p,b]=(0,n.useState)([]),[w,S]=(0,n.useState)([]),[I,Z]=(0,n.useState)(!1),[P,E]=(0,n.useState)(k),[A,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!e.show)return;(async()=>{try{var s,t,n,a,i,o,d;const c=await(0,f.Fk)(),m=(null!==(s=null!==(t=null!==(n=null===c||void 0===c||null===(a=c.data)||void 0===a?void 0:a.data)&&void 0!==n?n:null===c||void 0===c||null===(i=c.data)||void 0===i?void 0:i.contacts)&&void 0!==t?t:null===c||void 0===c?void 0:c.data)&&void 0!==s?s:[]).filter(e=>e&&(e.name||e.email||e.phone||e.designation));l(m);const u=null!==(o=null===(d=e.data)||void 0===d?void 0:d.contactPersons)&&void 0!==o?o:[],x=[];m.forEach((e,s)=>{u.find(s=>s.id&&e.id&&s.id===e.id||s.email&&e.email&&s.email===e.email)&&x.push(s)}),r(x)}catch(c){console.error("Failed to load contacts:",c),l([]),r([])}})(),(async()=>{try{var e,s,t,n,a;const i=await(0,N.AF)(),l=(null!==(e=null!==(s=null!==(t=null===i||void 0===i||null===(n=i.data)||void 0===n?void 0:n.data)&&void 0!==t?t:null===i||void 0===i||null===(a=i.data)||void 0===a?void 0:a.boards)&&void 0!==s?s:null===i||void 0===i?void 0:i.data)&&void 0!==e?e:[]).filter(e=>e&&("string"===typeof e.boardName||"string"===typeof e.name||"undefined"!==typeof e.id));b(l),S([])}catch(i){console.error("Failed to load boards:",i),b([])}})(),(async()=>{F(!0);try{var e,s,t,n,a;const i=await(0,C.tu)(),l=((null!==(e=null!==(s=null!==(t=null===i||void 0===i||null===(n=i.data)||void 0===n?void 0:n.data)&&void 0!==t?t:null===i||void 0===i||null===(a=i.data)||void 0===a?void 0:a.roles)&&void 0!==s?s:null===i||void 0===i?void 0:i.data)&&void 0!==e?e:[])||[]).map(e=>{return e||0===e?"string"===typeof e?e:"object"===typeof e&&null!==(s=null!==(t=null!==(n=null!==(a=null!==(i=e.role)&&void 0!==i?i:e.name)&&void 0!==a?a:e.roleName)&&void 0!==n?n:e.title)&&void 0!==t?t:e.label)&&void 0!==s?s:null:null;var s,t,n,a,i}).filter(Boolean);l.length>0?E(l):E(k)}catch(i){console.error("Failed to load roles:",i),E(k)}finally{F(!1)}})()},[e.show,e.data]),(0,n.useEffect)(()=>{const s={};o.forEach(t=>{var n,a;const l=i[t];let o;if(null!==(n=e.data)&&void 0!==n&&null!==(a=n.contactPersons)&&void 0!==a&&a.length){const s=e.data.contactPersons.find(e=>e.id&&(null===l||void 0===l?void 0:l.id)&&e.id===l.id||e.email&&(null===l||void 0===l?void 0:l.email)&&e.email===l.email);o=null===s||void 0===s?void 0:s.roles}s[t]=o&&Array.isArray(o)?o:[]}),h(e=>(0,g.Z)((0,g.Z)({},s),e)),m({})},[i,o,e.data]);const z=e=>{r(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]),h(s=>{const t=(0,g.Z)({},s);return t[e]&&delete t[e],t}),m(s=>{const t=(0,g.Z)({},s);return t[e]&&delete t[e],t})},H=e=>o.includes(e),L=e=>{m(s=>(0,g.Z)((0,g.Z)({},s),{},{[e]:!s[e]}))};o.map(e=>i[e]),w.map(e=>p[e]),o.length;return(0,y.jsxs)(v.Z,{show:e.show,onHide:()=>e.onHide(),centered:!0,className:"college-modal",dialogClassName:"college-modal-dialog","aria-labelledby":"college-info-modal-title",children:[(0,y.jsx)("style",{children:"\n        /* Make the modal wider and responsive */\n        .college-modal .modal-dialog {\n          max-width: 1200px;      /* increase as needed */\n          width: 95vw;\n        }\n        /* Ensure modal body doesn't force horizontal scroll */\n        .college-modal .modal-body {\n          overflow-x: hidden;\n        }\n\n        /* Let tables auto-layout and wrap cells instead of creating horizontal scroll */\n        .college-modal .table-responsive {\n          overflow-x: visible !important;\n        }\n        .college-modal table {\n          table-layout: auto;\n          width: 100%;\n        }\n        .college-modal th, .college-modal td {\n          white-space: normal;\n          word-wrap: break-word;\n          vertical-align: middle;\n        }\n\n        /* Make role badges wrap to next line when space is insufficient */\n        .college-modal .badge {\n          white-space: nowrap;\n          margin-bottom: 4px;\n        }\n\n        /* Ensure the per-contact dropdown doesn't push layout horizontally */\n        .college-modal .card.position-absolute {\n          left: 0;\n          right: auto;\n          max-width: 420px;\n        }\n\n        /* Small screens fallback */\n        @media (max-width: 768px) {\n          .college-modal .modal-dialog {\n            max-width: 100%;\n            width: 98vw;\n          }\n        }\n      "}),(0,y.jsxs)(v.Z.Header,{className:"border-0 pb-0",children:[(0,y.jsxs)("div",{className:"d-flex flex-column",children:[(0,y.jsx)("h3",{id:"college-info-modal-title",className:"mb-1 fw-bold",children:"Assign Roles"}),(0,y.jsx)("span",{className:"text-muted small",children:"Assign roles to the selected contact person"})]}),(0,y.jsx)("div",{className:"btn btn-sm btn-icon btn-light ms-3",onClick:()=>e.onHide(),style:{cursor:"pointer"},children:(0,y.jsx)(x.Z,{animation:j.Z,size:24,strokeColor:"#181C32",reverse:!0})})]}),(0,y.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!e.data)return void e.onHide();const t=o.map(e=>{var s;const t=i[e],n=null!==(s=u[e])&&void 0!==s?s:[];return(0,g.Z)((0,g.Z)({},t),{},{roles:n})}),n=w.map(e=>p[e]);a(!0);try{const s=(0,g.Z)((0,g.Z)({},e.data),{},{contactPersons:t});n.length>0&&(s.boards=n),await(0,d.J6)(s),e.setPageLoading(["true"]),e.onHide(!1)}catch(l){console.error("UpdateCollegeData failed",l),window.location.replace("/error")}finally{a(!1)}},className:"form w-100",children:[(0,y.jsx)(v.Z.Body,{className:"pt-3",children:(0,y.jsx)("div",{className:"d-flex flex-column gap-4",children:(0,y.jsx)("div",{className:"card shadow-sm border-0",children:(0,y.jsxs)("div",{className:"card-body",children:[(0,y.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:(0,y.jsxs)("div",{children:[(0,y.jsx)("h5",{className:"mb-0",children:"Selected Contact Person"}),(0,y.jsx)("small",{className:"text-muted",children:"Choose one or more roles associated with the contact person."})]})}),(0,y.jsx)("div",{className:"mt-3",children:0===i.length?(0,y.jsx)("div",{className:"text-muted small",children:"No contacts available"}):(0,y.jsx)("div",{className:"list-group",children:i.map((e,s)=>{var t,n,a,i;return(0,y.jsxs)("label",{className:"list-group-item d-flex justify-content-between align-items-center ".concat(H(s)?"active":""),style:{cursor:"pointer"},children:[(0,y.jsxs)("div",{className:"form-check",children:[(0,y.jsx)("input",{className:"form-check-input me-2",type:"checkbox",checked:H(s),onChange:()=>z(s)}),(0,y.jsx)("span",{className:"fw-semibold",children:null!==(t=null!==(n=null!==(a=e.name)&&void 0!==a?a:e.email)&&void 0!==n?n:e.phone)&&void 0!==t?t:"Unnamed"}),(0,y.jsxs)("div",{className:"small text-muted",children:[e.designation?"".concat(e.designation," \u2022 "):"",null!==(i=e.email)&&void 0!==i?i:e.phone]})]}),(0,y.jsx)("div",{children:(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:e=>{e.stopPropagation(),H(s)||z(s),L(s)},children:"Roles"})})]},s)})})}),(0,y.jsxs)("div",{className:"mt-4",children:[(0,y.jsx)("h6",{className:"mb-2",children:"Selected Contacts & Roles"}),0===o.length?(0,y.jsx)("div",{className:"text-muted small",children:"No contact selected yet."}):(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table table-hover align-middle",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{style:{width:"35%"},children:"Contact"}),(0,y.jsx)("th",{style:{width:"50%"},children:"Assigned Roles"}),(0,y.jsx)("th",{style:{width:"15%"},children:"Actions"})]})}),(0,y.jsx)("tbody",{children:o.map(e=>{var s,t,n,a,l;const o=i[e],d=null!==(s=u[e])&&void 0!==s?s:[],r=!!c[e];return(0,y.jsxs)("tr",{children:[(0,y.jsxs)("td",{children:[(0,y.jsx)("div",{className:"fw-semibold",children:null!==(t=null!==(n=null!==(a=o.name)&&void 0!==a?a:o.email)&&void 0!==n?n:o.phone)&&void 0!==t?t:"Unnamed"}),(0,y.jsxs)("div",{className:"small text-muted",children:[null!==(l=o.designation)&&void 0!==l?l:"",o.email?" \u2022 ".concat(o.email):""]})]}),(0,y.jsxs)("td",{children:[(0,y.jsx)("div",{className:"d-flex flex-wrap gap-2",children:0===d.length?(0,y.jsx)("span",{className:"small text-muted",children:"No roles assigned"}):d.map(s=>(0,y.jsxs)("span",{className:"badge bg-light text-dark border d-inline-flex align-items-center",style:{padding:"0.45rem 0.6rem"},children:[(0,y.jsx)("span",{className:"me-2 small",children:s}),(0,y.jsx)("button",{type:"button","aria-label":"Remove ".concat(s),className:"btn btn-sm btn-icon btn-light btn-xs",onClick:()=>{return t=e,n=s,void h(e=>{var s;const a=null!==(s=e[t])&&void 0!==s?s:[];return(0,g.Z)((0,g.Z)({},e),{},{[t]:a.filter(e=>e!==n)})});var t,n},style:{border:"none",padding:"0",margin:"0",lineHeight:1,cursor:"pointer"},children:(0,y.jsx)("span",{style:{fontSize:14,marginLeft:4},children:"\xd7"})})]},s))}),(0,y.jsx)("div",{className:"position-relative mt-2",children:r&&(0,y.jsxs)("div",{className:"card shadow-sm position-absolute",style:{zIndex:1200,left:0,top:0,minWidth:260,padding:12},onClick:e=>e.stopPropagation(),children:[(0,y.jsx)("div",{className:"fw-semibold mb-2",children:"Select Roles"}),A?(0,y.jsx)("div",{className:"small text-muted",children:"Loading roles..."}):(0,y.jsx)("div",{className:"roles-list",style:{maxHeight:220,overflow:"auto"},children:P.map(s=>{var t;const n=(null!==(t=u[e])&&void 0!==t?t:[]).includes(s);return(0,y.jsxs)("div",{className:"form-check mb-1",children:[(0,y.jsx)("input",{className:"form-check-input",type:"checkbox",id:"contact-".concat(e,"-role-").concat(s),checked:n,onChange:t=>((e,s,t)=>{h(n=>{var a;const i=null!==(a=n[e])&&void 0!==a?a:[];return t?i.includes(s)?n:(0,g.Z)((0,g.Z)({},n),{},{[e]:[...i,s]}):(0,g.Z)((0,g.Z)({},n),{},{[e]:i.filter(e=>e!==s)})})})(e,s,t.target.checked)}),(0,y.jsx)("label",{className:"form-check-label ms-2",htmlFor:"contact-".concat(e,"-role-").concat(s),style:{cursor:"pointer"},children:s})]},s)})}),(0,y.jsxs)("div",{className:"d-flex justify-content-end mt-2",children:[(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-secondary me-2",onClick:()=>m(s=>(0,g.Z)((0,g.Z)({},s),{},{[e]:!1})),children:"Done"}),(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>h(s=>(0,g.Z)((0,g.Z)({},s),{},{[e]:[]})),children:"Clear"})]})]})})]}),(0,y.jsx)("td",{children:(0,y.jsxs)("div",{className:"d-flex gap-2",children:[(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>L(e),children:r?"Close":"Edit"}),(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>z(e),children:"Remove"})]})})]},e)})})]})})]})]})})})}),(0,y.jsx)(v.Z.Footer,{className:"border-0 pt-0",children:(0,y.jsxs)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[(0,y.jsx)("div",{className:"text-muted small",children:(null===(s=e.data)||void 0===s?void 0:s.instituteCode)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{className:"fw-semibold",children:"Institute Code: "}),(0,y.jsx)("span",{children:e.data.instituteCode})]})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-light me-2",onClick:()=>e.onHide(),disabled:t,children:"Cancel"}),(0,y.jsxs)("button",{type:"submit",className:"btn btn-sm btn-primary",disabled:t||0===i.length&&0===p.length,children:[!t&&(0,y.jsx)("span",{className:"indicator-label",children:"Save Selection"}),t&&(0,y.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait...",(0,y.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})})]})]})};var I=t(21799);const Z=e=>{var s,t,a;const[i,l]=(0,n.useState)(!1),[o,r]=(0,n.useState)(!1),[c,m]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),[p,b]=(0,n.useState)(!1),[N,f]=(0,n.useState)(!1),[w,C]=(0,n.useState)([]),[k,S]=(0,n.useState)([]),[Z,P]=(0,n.useState)(""),[E,A]=(0,n.useState)(""),[F,z]=(0,n.useState)(""),[H,L]=(0,n.useState)(null),[D,K]=(0,n.useState)(null),[M,R]=(0,n.useState)(null),[B,T]=(0,n.useState)(null),[U,_]=(0,n.useState)(null),[q,W]=(0,n.useState)(null),[Y,O]=(0,n.useState)(""),[V,G]=(0,n.useState)(null),[J,X]=(0,n.useState)(null),[$,Q]=(0,n.useState)(null),ee=async e=>{if(e){console.log("Fetching data for institute code:",e),r(!0),m(null);try{const s=await(0,d.$E)(e);console.log("API Response:",s.data);const t=s.data.map(e=>({id:e.id,sessionName:e.sessionYear,grades:(e.schoolClasses||[]).map(e=>({id:e.id,gradeName:e.className,sections:(e.schoolSections||[]).map(e=>({id:e.id,sectionName:e.sectionName,isNew:!1})),isNew:!1})),isNew:!1}));console.log("Transformed Data:",t),C(t)}catch(t){var s;console.error("Error fetching existing data:",t),console.error("Error details:",(null===(s=t.response)||void 0===s?void 0:s.data)||t.message),m("Failed to load existing data")}finally{r(!1)}}else console.log("No institute code provided, skipping fetch")};(0,n.useEffect)(()=>{if(e.show){var s;console.log("Modal opened with data:",e.data),S([]),P(""),A(""),z(""),L(null),K(null),h(!1),b(!1),f(!1),R(null),T(null),_(null),W(null),G(null),X(null),Q(null),m(null),C([]);const t=null===(s=e.data)||void 0===s?void 0:s.instituteCode;t&&""!==t?ee(t):console.log("No valid institute code in props.data:",e.data)}},[e.show,null===(s=e.data)||void 0===s?void 0:s.instituteCode]);const se=()=>{if(Z.trim()){k.some(e=>e.sessionName===Z.trim())||(S([...k,{id:null,sessionName:Z.trim(),grades:[],isNew:!0}]),P(""))}},te=async()=>{if(E.trim())if("existing"===M&&null!==B){const n=w[B];if(n.grades.some(e=>e.gradeName===E.trim()))return;l(!0);try{var s;await(0,d.Oj)({className:E.trim(),schoolSession:{id:n.id}}),A(""),null!==(s=e.data)&&void 0!==s&&s.instituteCode&&await ee(e.data.instituteCode)}catch(t){console.error("Error creating class:",t),m("Failed to add grade. Please try again.")}finally{l(!1)}}else if("new"===M&&null!==H){const e=[...k],s=e[H];s.grades.some(e=>e.gradeName===E.trim())||(s.grades.push({id:null,gradeName:E.trim(),sections:[],isNew:!0}),S(e),A(""))}},ne=async()=>{if(F.trim())if("existing"===M&&null!==B&&null!==U){const n=w[B].grades[U];if(n.sections.some(e=>e.sectionName===F.trim()))return;l(!0);try{var s;await(0,d.eP)({sectionName:F.trim(),schoolClasses:{id:n.id}}),z(""),null!==(s=e.data)&&void 0!==s&&s.instituteCode&&await ee(e.data.instituteCode)}catch(t){console.error("Error creating section:",t),m("Failed to add section. Please try again.")}finally{l(!1)}}else if("new"===M&&null!==H&&null!==D){const e=[...k],s=e[H].grades[D];s.sections.some(e=>e.sectionName===F.trim())||(s.sections.push({id:null,sectionName:F.trim(),isNew:!0}),S(e),z(""))}},ae=(e,s,t,n,a,i)=>{W({type:e,id:s,sessionIndex:t,gradeIndex:a,sectionIndex:i,originalValue:n}),O(n)},ie=()=>{W(null),O("")},le=async()=>{if(!q||!Y.trim())return;const e=[...w],s=e[q.sessionIndex];"session"===q.type?s.sessionName=Y.trim():"grade"===q.type&&void 0!==q.gradeIndex?s.grades[q.gradeIndex].gradeName=Y.trim():"section"===q.type&&void 0!==q.gradeIndex&&void 0!==q.sectionIndex&&(s.grades[q.gradeIndex].sections[q.sectionIndex].sectionName=Y.trim()),C(e),W(null),O("");try{"session"===q.type?await(0,d.oL)(q.id,{sessionYear:Y.trim()}):"grade"===q.type?await(0,d.Zo)(q.id,{className:Y.trim()}):"section"===q.type&&await(0,d.Xg)(q.id,{sectionName:Y.trim()})}catch(t){console.error("Error updating:",t);const e=[...w],s=e[q.sessionIndex];"session"===q.type?s.sessionName=q.originalValue:"grade"===q.type&&void 0!==q.gradeIndex?s.grades[q.gradeIndex].gradeName=q.originalValue:"section"===q.type&&void 0!==q.gradeIndex&&void 0!==q.sectionIndex&&(s.grades[q.gradeIndex].sections[q.sectionIndex].sectionName=q.originalValue),C(e),m("Failed to update. Please try again.")}},oe=async()=>{if(V&&V.value.trim()){l(!0);try{var s;"session"===V.type?await(0,d.oL)(V.id,{sessionYear:V.value.trim()}):"grade"===V.type?await(0,d.Zo)(V.id,{className:V.value.trim()}):"section"===V.type&&await(0,d.Xg)(V.id,{sectionName:V.value.trim()}),null!==(s=e.data)&&void 0!==s&&s.instituteCode&&await ee(e.data.instituteCode)}catch(t){console.error("Error updating:",t),m("Failed to update. Please try again.")}finally{l(!1),G(null)}}},de=(e,s,t,n,a,i)=>{Q({type:e,id:s,name:t,sessionIndex:n,gradeIndex:a,sectionIndex:i})},re=()=>{var e,s;return"existing"===M&&null!==B?null===(e=w[B])||void 0===e?void 0:e.sessionName:"new"===M&&null!==H?null===(s=k[H])||void 0===s?void 0:s.sessionName:null},ce=()=>{var e,s,t,n;return"existing"===M&&null!==B&&null!==U?null===(e=w[B])||void 0===e||null===(s=e.grades[U])||void 0===s?void 0:s.gradeName:"new"===M&&null!==H&&null!==D?null===(t=k[H])||void 0===t||null===(n=t.grades[D])||void 0===n?void 0:n.gradeName:null},me=()=>{var e,s,t,n;return"existing"===M&&null!==B&&null!==U?(null===(e=w[B])||void 0===e||null===(s=e.grades[U])||void 0===s?void 0:s.sections)||[]:"new"===M&&null!==H&&null!==D&&(null===(t=k[H])||void 0===t||null===(n=t.grades[D])||void 0===n?void 0:n.sections)||[]},ue=()=>{var e,s;return"existing"===M&&null!==B?(null===(e=w[B])||void 0===e?void 0:e.grades)||[]:"new"===M&&null!==H&&(null===(s=k[H])||void 0===s?void 0:s.grades)||[]},xe=null!==M&&("new"===M&&null!==H||"existing"===M&&null!==B),he=xe&&("new"===M&&null!==D||"existing"===M&&null!==U),pe=(0,n.useMemo)(()=>{const e=[];return w.forEach((s,t)=>{0===s.grades.length?e.push({sessionId:s.id,sessionName:s.sessionName,sessionIndex:t,gradeId:null,gradeName:"-",gradeIndex:null,sectionId:null,sectionName:"-",sectionIndex:null}):s.grades.forEach((n,a)=>{0===n.sections.length?e.push({sessionId:s.id,sessionName:s.sessionName,sessionIndex:t,gradeId:n.id,gradeName:n.gradeName,gradeIndex:a,sectionId:null,sectionName:"-",sectionIndex:null}):n.sections.forEach((i,l)=>{e.push({sessionId:s.id,sessionName:s.sessionName,sessionIndex:t,gradeId:n.id,gradeName:n.gradeName,gradeIndex:a,sectionId:i.id,sectionName:i.sectionName,sectionIndex:l})})})}),e},[w]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(v.Z,{show:e.show,onHide:()=>e.onHide(),centered:!0,size:"xl",className:"college-modal","aria-labelledby":"college-detail-modal-title",style:{maxHeight:"90vh"},children:[(0,y.jsx)("style",{children:"\n          .college-modal .modal-dialog {\n            max-width: 1200px;\n            height: 85vh;\n          }\n\n          .college-modal .modal-content {\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n          }\n\n          .college-modal .modal-body {\n            flex: 1;\n            overflow-y: auto;\n            max-height: calc(85vh - 180px);\n          }\n\n          .college-modal .dropdown-menu {\n            max-height: 300px;\n          }\n\n          .editable-cell:hover {\n            background-color: #f8f9fa;\n            cursor: pointer;\n          }\n        "}),(0,y.jsxs)(v.Z.Header,{className:"border-0 pb-0",children:[(0,y.jsxs)("div",{className:"d-flex flex-column",children:[(0,y.jsx)("h3",{id:"college-detail-modal-title",className:"mb-1 fw-bold",children:"Institute Details"}),(0,y.jsxs)("span",{className:"text-muted small",children:[(null===(t=e.data)||void 0===t?void 0:t.instituteName)&&(0,y.jsx)("span",{className:"fw-semibold me-2",children:e.data.instituteName}),"Manage sessions, grades, and sections"]})]}),(0,y.jsx)("div",{className:"btn btn-sm btn-icon btn-light ms-3",onClick:()=>e.onHide(),style:{cursor:"pointer"},children:(0,y.jsx)(x.Z,{animation:j.Z,size:24,strokeColor:"#181C32",reverse:!0})})]}),(0,y.jsxs)("div",{className:"form w-100",children:[(0,y.jsxs)(v.Z.Body,{className:"pt-3",children:[c&&(0,y.jsxs)("div",{className:"alert alert-danger alert-dismissible mb-3",children:[c,(0,y.jsx)("button",{type:"button",className:"btn-close",onClick:()=>m(null)})]}),(0,y.jsx)("div",{className:"card shadow-sm border-0 mb-4",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)"},children:(0,y.jsxs)("div",{className:"card-body",children:[(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)("h5",{className:"mb-1 fw-semibold",children:"Add New Items"}),(0,y.jsx)("small",{className:"text-muted",children:"Add new sessions, grades, and sections for this institute"})]}),(0,y.jsxs)("div",{className:"d-flex gap-3 flex-wrap",children:[(0,y.jsxs)("div",{className:"flex-fill position-relative",style:{minWidth:"200px"},children:[(0,y.jsx)("button",{type:"button",className:"btn btn-primary dropdown-toggle d-flex align-items-center justify-content-between gap-2 w-100",onClick:()=>{h(!u),b(!1),f(!1)},children:(0,y.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,y.jsx)("i",{className:"bi bi-calendar-plus"}),(0,y.jsx)("span",{children:re()||"Session"})]})}),u&&(0,y.jsxs)("div",{className:"dropdown-menu show w-100 p-3 shadow-lg",style:{minWidth:"100%",maxHeight:"300px",overflowY:"auto",position:"absolute",zIndex:1e3},children:[(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)("label",{className:"form-label small fw-semibold",children:"Add New Session"}),(0,y.jsxs)("div",{className:"input-group",children:[(0,y.jsx)("input",{type:"text",className:"form-control",placeholder:"e.g., 2024-25",value:Z,onChange:e=>P(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(se(),e.preventDefault())}}),(0,y.jsx)("button",{type:"button",className:"btn btn-primary",onClick:se,disabled:!Z.trim(),children:(0,y.jsx)("i",{className:"bi bi-plus-lg"})})]})]}),w.length>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"dropdown-divider"}),(0,y.jsx)("label",{className:"form-label small fw-semibold",children:"Existing Sessions"}),(0,y.jsx)("div",{className:"list-group",children:w.map((e,s)=>(0,y.jsx)("div",{className:"list-group-item ".concat("existing"===M&&B===s?"active":""),children:"session"===(null===V||void 0===V?void 0:V.type)&&V.index===s?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:V.value,onChange:e=>G((0,g.Z)((0,g.Z)({},V),{},{value:e.target.value})),onKeyPress:e=>{"Enter"===e.key&&oe()},onKeyDown:e=>{"Escape"===e.key&&G(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{e.stopPropagation(),oe()},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),G(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsx)("span",{className:"flex-grow-1",style:{cursor:"pointer"},onClick:()=>(e=>{R("existing"),T(e),_(null),L(null),K(null),h(!1)})(s),children:e.sessionName}),(0,y.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,y.jsxs)("span",{className:"badge bg-primary me-1",children:[e.grades.length," grades"]}),(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),G({type:"session",index:s,id:e.id,value:e.sessionName})},title:"Edit session",children:(0,y.jsx)("i",{className:"bi bi-pencil"})})]})]})},"existing-".concat(s)))})]}),k.length>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"dropdown-divider"}),(0,y.jsx)("label",{className:"form-label small fw-semibold",children:"New Sessions"}),(0,y.jsx)("div",{className:"list-group",children:k.map((e,s)=>(0,y.jsx)("div",{className:"list-group-item ".concat("new"===M&&H===s?"active":""),children:"session"===(null===J||void 0===J?void 0:J.type)&&J.index===s?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:J.value,onChange:e=>X((0,g.Z)((0,g.Z)({},J),{},{value:e.target.value})),onKeyPress:e=>{if("Enter"===e.key){if(J.value.trim()){const e=[...k];e[s].sessionName=J.value.trim(),S(e)}X(null)}},onKeyDown:e=>{"Escape"===e.key&&X(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{if(e.stopPropagation(),J.value.trim()){const e=[...k];e[s].sessionName=J.value.trim(),S(e)}X(null)},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),X(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsx)("span",{className:"flex-grow-1",style:{cursor:"pointer"},onClick:()=>(e=>{R("new"),L(e),K(null),T(null),_(null),h(!1)})(s),children:e.sessionName}),(0,y.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,y.jsxs)("span",{className:"badge bg-secondary me-1",children:[e.grades.length," grades"]}),(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),X({type:"session",index:s,value:e.sessionName})},title:"Edit session",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-outline-danger py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:e=>{e.stopPropagation();const t=k.filter((e,t)=>t!==s);S(t),H===s?(L(null),K(null),R(null)):null!==H&&H>s&&L(H-1)},title:"Remove session",children:(0,y.jsx)("i",{className:"bi bi-trash"})})]})]})},"new-".concat(s)))})]})]})]}),(0,y.jsxs)("div",{className:"flex-fill position-relative",style:{minWidth:"200px"},children:[(0,y.jsx)("button",{type:"button",className:"btn btn-success dropdown-toggle d-flex align-items-center justify-content-between gap-2 w-100",onClick:()=>{xe&&(b(!p),h(!1),f(!1))},disabled:!xe,children:(0,y.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,y.jsx)("i",{className:"bi bi-award"}),(0,y.jsx)("span",{children:ce()||"Grade"}),!xe&&(0,y.jsx)("small",{className:"ms-1 text-light",children:"(select session)"})]})}),p&&xe&&(0,y.jsxs)("div",{className:"dropdown-menu show w-100 p-3 shadow-lg",style:{minWidth:"100%",maxHeight:"300px",overflowY:"auto",position:"absolute",zIndex:1e3},children:[(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsxs)("label",{className:"form-label small fw-semibold",children:['Add Grade to "',re(),'"']}),(0,y.jsxs)("div",{className:"input-group",children:[(0,y.jsx)("input",{type:"text",className:"form-control",placeholder:"e.g., Class 9",value:E,onChange:e=>A(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(te(),e.preventDefault())}}),(0,y.jsx)("button",{type:"button",className:"btn btn-success",onClick:te,disabled:!E.trim(),children:(0,y.jsx)("i",{className:"bi bi-plus-lg"})})]})]}),ue().length>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"dropdown-divider"}),(0,y.jsx)("label",{className:"form-label small fw-semibold",children:"Grades"}),(0,y.jsx)("div",{className:"list-group",children:ue().map((e,s)=>{const t="existing"===M?U===s:D===s,n="existing"===M&&e.id;return(0,y.jsx)("div",{className:"list-group-item ".concat(t?"active":""),children:n&&"grade"===(null===V||void 0===V?void 0:V.type)&&V.index===s?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:V.value,onChange:e=>G((0,g.Z)((0,g.Z)({},V),{},{value:e.target.value})),onKeyPress:e=>{"Enter"===e.key&&oe()},onKeyDown:e=>{"Escape"===e.key&&G(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{e.stopPropagation(),oe()},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),G(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):n||"grade"!==(null===J||void 0===J?void 0:J.type)||J.index!==s?(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsx)("span",{className:"flex-grow-1",style:{cursor:"pointer"},onClick:()=>{return e=s,"existing"===M?_(e):K(e),void b(!1);var e},children:e.gradeName}),(0,y.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,y.jsxs)("span",{className:"badge bg-secondary me-1",children:[e.sections.length," sections"]}),n?(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),G({type:"grade",index:s,id:e.id,value:e.gradeName})},title:"Edit grade",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}):(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),X({type:"grade",index:s,value:e.gradeName})},title:"Edit grade",children:(0,y.jsx)("i",{className:"bi bi-pencil"})})]})]}):(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:J.value,onChange:e=>X((0,g.Z)((0,g.Z)({},J),{},{value:e.target.value})),onKeyPress:e=>{if("Enter"===e.key){if(J.value.trim()&&null!==H){const e=[...k];e[H].grades[s].gradeName=J.value.trim(),S(e)}X(null)}},onKeyDown:e=>{"Escape"===e.key&&X(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{if(e.stopPropagation(),J.value.trim()&&null!==H){const e=[...k];e[H].grades[s].gradeName=J.value.trim(),S(e)}X(null)},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),X(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]})},s)})})]})]})]}),(0,y.jsxs)("div",{className:"flex-fill position-relative",style:{minWidth:"200px"},children:[(0,y.jsx)("button",{type:"button",className:"btn btn-info dropdown-toggle d-flex align-items-center justify-content-between gap-2 w-100",onClick:()=>{he&&(f(!N),h(!1),b(!1))},disabled:!he,children:(0,y.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,y.jsx)("i",{className:"bi bi-grid-3x3"}),(0,y.jsxs)("span",{children:["Section (",me().length,")"]}),!he&&(0,y.jsx)("small",{className:"ms-1 text-light",children:"(select grade)"})]})}),N&&he&&(0,y.jsxs)("div",{className:"dropdown-menu show w-100 p-3 shadow-lg",style:{minWidth:"100%",maxHeight:"300px",overflowY:"auto",position:"absolute",zIndex:1e3},children:[(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsxs)("label",{className:"form-label small fw-semibold",children:['Add Section to "',ce(),'"']}),(0,y.jsxs)("div",{className:"input-group",children:[(0,y.jsx)("input",{type:"text",className:"form-control",placeholder:"e.g., A, B, C",value:F,onChange:e=>z(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(ne(),e.preventDefault())}}),(0,y.jsx)("button",{type:"button",className:"btn btn-info",onClick:ne,disabled:!F.trim(),children:(0,y.jsx)("i",{className:"bi bi-plus-lg"})})]})]}),me().length>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"dropdown-divider"}),(0,y.jsx)("label",{className:"form-label small fw-semibold",children:"Sections"}),(0,y.jsx)("div",{className:"list-group",children:me().map((e,s)=>(0,y.jsx)("div",{className:"list-group-item",children:"existing"===M&&"section"===(null===V||void 0===V?void 0:V.type)&&V.index===s?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:V.value,onChange:e=>G((0,g.Z)((0,g.Z)({},V),{},{value:e.target.value})),onKeyPress:e=>{"Enter"===e.key&&oe()},onKeyDown:e=>{"Escape"===e.key&&G(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{e.stopPropagation(),oe()},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),G(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):"new"===M&&"section"===(null===J||void 0===J?void 0:J.type)&&J.index===s?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:J.value,onChange:e=>X((0,g.Z)((0,g.Z)({},J),{},{value:e.target.value})),onKeyPress:e=>{if("Enter"===e.key){if(J.value.trim()&&null!==H&&null!==D){const e=[...k];e[H].grades[D].sections[s].sectionName=J.value.trim(),S(e)}X(null)}},onKeyDown:e=>{"Escape"===e.key&&X(null)},autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:e=>{if(e.stopPropagation(),J.value.trim()&&null!==H&&null!==D){const e=[...k];e[H].grades[D].sections[s].sectionName=J.value.trim(),S(e)}X(null)},children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:e=>{e.stopPropagation(),X(null)},children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,y.jsxs)("span",{children:[e.sectionName,e.id&&(0,y.jsx)("span",{className:"badge bg-light text-muted ms-2",style:{fontSize:"0.65rem"},children:"existing"})]}),(0,y.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[e.id&&"existing"===M&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),G({type:"section",index:s,id:e.id,value:e.sectionName})},title:"Edit section",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),"new"===M&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:t=>{t.stopPropagation(),X({type:"section",index:s,value:e.sectionName})},title:"Edit section",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger py-0 px-1",style:{fontSize:"0.7rem",lineHeight:1.2},onClick:()=>(e=>{if("new"===M&&null!==H&&null!==D){const s=[...k];s[H].grades[D].sections.splice(e,1),S(s)}})(s),title:"Remove section",children:(0,y.jsx)("i",{className:"bi bi-trash"})})]})]})]})},s))})]})]})]})]}),k.length>0&&(0,y.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border",children:[(0,y.jsxs)("h6",{className:"mb-2 fw-semibold d-flex align-items-center gap-2",children:[(0,y.jsx)("i",{className:"bi bi-plus-circle text-success"}),"New Items to Submit"]}),(0,y.jsx)("div",{className:"d-flex flex-wrap gap-2",children:k.map((e,s)=>(0,y.jsxs)("span",{className:"badge bg-primary px-2 py-1",children:[e.sessionName," (",e.grades.length," grades)"]},s))})]})]})}),(0,y.jsx)("div",{className:"card shadow-sm border-0",children:(0,y.jsxs)("div",{className:"card-body",children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h5",{className:"mb-1 fw-semibold",children:"Existing Data"}),(0,y.jsx)("small",{className:"text-muted",children:"Use the edit and delete buttons to manage existing data. Changes are saved immediately."})]}),o&&(0,y.jsx)("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:(0,y.jsx)("span",{className:"visually-hidden",children:"Loading..."})})]}),0!==pe.length||o?(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table table-bordered table-hover mb-0",children:[(0,y.jsx)("thead",{className:"table-light",children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{style:{width:"25%"},children:"Session"}),(0,y.jsx)("th",{style:{width:"25%"},children:"Grade/Class"}),(0,y.jsx)("th",{style:{width:"25%"},children:"Section"}),(0,y.jsx)("th",{style:{width:"25%"},children:"Actions"})]})}),(0,y.jsx)("tbody",{children:pe.map((e,s)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"editable-cell",children:"session"===(null===q||void 0===q?void 0:q.type)&&q.sessionIndex===e.sessionIndex?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:Y,onChange:e=>O(e.target.value),onKeyPress:e=>{"Enter"===e.key&&le(),"Escape"===e.key&&ie()},autoFocus:!0}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:le,children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:ie,children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsx)("span",{onClick:()=>e.sessionId&&ae("session",e.sessionId,e.sessionIndex,e.sessionName),title:"Click to edit",children:e.sessionName})}),(0,y.jsx)("td",{className:"editable-cell",children:"grade"===(null===q||void 0===q?void 0:q.type)&&q.sessionIndex===e.sessionIndex&&q.gradeIndex===e.gradeIndex?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:Y,onChange:e=>O(e.target.value),onKeyPress:e=>{"Enter"===e.key&&le(),"Escape"===e.key&&ie()},autoFocus:!0}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:le,children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:ie,children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsx)("span",{onClick:()=>e.gradeId&&ae("grade",e.gradeId,e.sessionIndex,e.gradeName,e.gradeIndex),title:e.gradeId?"Click to edit":"",style:{color:e.gradeId?"inherit":"#6c757d"},children:e.gradeName})}),(0,y.jsx)("td",{className:"editable-cell",children:"section"===(null===q||void 0===q?void 0:q.type)&&q.sessionIndex===e.sessionIndex&&q.gradeIndex===e.gradeIndex&&q.sectionIndex===e.sectionIndex?(0,y.jsxs)("div",{className:"d-flex gap-1",children:[(0,y.jsx)("input",{type:"text",className:"form-control form-control-sm",value:Y,onChange:e=>O(e.target.value),onKeyPress:e=>{"Enter"===e.key&&le(),"Escape"===e.key&&ie()},autoFocus:!0}),(0,y.jsx)("button",{className:"btn btn-sm btn-success",onClick:le,children:(0,y.jsx)("i",{className:"bi bi-check"})}),(0,y.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:ie,children:(0,y.jsx)("i",{className:"bi bi-x"})})]}):(0,y.jsx)("span",{onClick:()=>e.sectionId&&ae("section",e.sectionId,e.sessionIndex,e.sectionName,e.gradeIndex,e.sectionIndex),title:e.sectionId?"Click to edit":"",style:{color:e.sectionId?"inherit":"#6c757d"},children:e.sectionName})}),(0,y.jsx)("td",{children:(0,y.jsxs)("div",{className:"d-flex gap-1 flex-wrap",children:[e.sectionId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ae("section",e.sectionId,e.sessionIndex,e.sectionName,e.gradeIndex,e.sectionIndex),title:"Edit section",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),e.gradeId&&!e.sectionId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ae("grade",e.gradeId,e.sessionIndex,e.gradeName,e.gradeIndex),title:"Edit grade",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),e.sessionId&&!e.gradeId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ae("session",e.sessionId,e.sessionIndex,e.sessionName),title:"Edit session",children:(0,y.jsx)("i",{className:"bi bi-pencil"})}),e.sectionId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>de("section",e.sectionId,e.sectionName,e.sessionIndex,e.gradeIndex,e.sectionIndex),title:"Delete section",children:(0,y.jsx)("i",{className:"bi bi-trash"})}),e.gradeId&&!e.sectionId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>de("grade",e.gradeId,e.gradeName,e.sessionIndex,e.gradeIndex),title:"Delete grade",children:(0,y.jsx)("i",{className:"bi bi-trash"})}),e.sessionId&&!e.gradeId&&(0,y.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>de("session",e.sessionId,e.sessionName,e.sessionIndex),title:"Delete session",children:(0,y.jsx)("i",{className:"bi bi-trash"})})]})})]},s))})]})}):(0,y.jsxs)("div",{className:"text-center text-muted py-5",children:[(0,y.jsx)("i",{className:"bi bi-inbox",style:{fontSize:"3rem"}}),(0,y.jsx)("p",{className:"mt-2 mb-0",children:"No existing data for this institute"})]})]})})]}),(0,y.jsx)(v.Z.Footer,{className:"border-0 pt-0",children:(0,y.jsxs)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[(0,y.jsx)("div",{className:"text-muted small",children:(null===(a=e.data)||void 0===a?void 0:a.instituteCode)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{className:"fw-semibold",children:"Institute Code: "}),(0,y.jsx)("span",{children:e.data.instituteCode})]})}),(0,y.jsxs)("div",{className:"d-flex gap-2",children:[(0,y.jsx)("button",{type:"button",className:"btn btn-sm btn-light",onClick:()=>e.onHide(),disabled:i,children:"Close"}),(0,y.jsxs)("button",{type:"button",className:"btn btn-sm btn-primary",onClick:async()=>{if(0===k.length)return;l(!0);const s=k.map(s=>{var t;return{id:null,sessionYear:s.sessionName,schoolClasses:s.grades.map(e=>({id:null,className:e.gradeName,schoolSections:e.sections.map(e=>({id:null,sectionName:e.sectionName}))})),instituteCode:(null===(t=e.data)||void 0===t?void 0:t.instituteCode)||null}});try{var t;await(0,d.oY)(s),alert("New sessions submitted successfully!"),S([]),L(null),K(null),null!==(t=e.data)&&void 0!==t&&t.instituteCode&&await ee(e.data.instituteCode)}catch(c){console.error("Error in CreateSessionData:",c),alert("Error submitting. Please try again.")}finally{l(!1)}},disabled:i||0===k.length,children:[!i&&(0,y.jsxs)("span",{className:"d-flex align-items-center gap-1",children:[(0,y.jsx)("i",{className:"bi bi-check-circle"}),"Submit New (",k.length,")"]}),i&&(0,y.jsxs)("span",{className:"d-flex align-items-center gap-2",children:[(0,y.jsx)("span",{className:"spinner-border spinner-border-sm"}),"Submitting..."]})]})]})]})})]})]}),(0,y.jsxs)(v.Z,{show:null!==$,onHide:()=>Q(null),centered:!0,size:"sm",children:[(0,y.jsx)(v.Z.Header,{closeButton:!0,children:(0,y.jsx)(v.Z.Title,{className:"h5",children:"Confirm Delete"})}),(0,y.jsxs)(v.Z.Body,{children:[(0,y.jsxs)("p",{className:"mb-2",children:["Are you sure you want to delete this ",null===$||void 0===$?void 0:$.type,"?"]}),(0,y.jsxs)("p",{className:"fw-bold text-danger mb-2",children:['"',null===$||void 0===$?void 0:$.name,'"']}),"session"===(null===$||void 0===$?void 0:$.type)&&(0,y.jsxs)("p",{className:"text-warning small mb-0",children:[(0,y.jsx)("i",{className:"bi bi-exclamation-triangle me-1"}),"This will also delete all grades and sections within this session."]}),"grade"===(null===$||void 0===$?void 0:$.type)&&(0,y.jsxs)("p",{className:"text-warning small mb-0",children:[(0,y.jsx)("i",{className:"bi bi-exclamation-triangle me-1"}),"This will also delete all sections within this grade."]})]}),(0,y.jsxs)(v.Z.Footer,{children:[(0,y.jsx)(I.Z,{variant:"secondary",size:"sm",onClick:()=>Q(null),children:"Cancel"}),(0,y.jsx)(I.Z,{variant:"danger",size:"sm",onClick:async()=>{if($){l(!0);try{var s;"session"===$.type?await(0,d.K4)($.id):"grade"===$.type?await(0,d.bA)($.id):"section"===$.type&&await(0,d.uS)($.id),null!==(s=e.data)&&void 0!==s&&s.instituteCode&&await ee(e.data.instituteCode)}catch(t){console.error("Error deleting:",t),m("Failed to delete. Please try again.")}finally{l(!1),Q(null)}}},disabled:i,children:i?(0,y.jsxs)("span",{className:"d-flex align-items-center gap-1",children:[(0,y.jsx)("span",{className:"spinner-border spinner-border-sm"}),"Deleting..."]}):"Delete"})]})]})]})};var P=t(55192),E=t(24849),A=t(4437),F=t(45736),z=t(15110);const H=e=>{const[s,t]=(0,n.useState)([]),[a,l]=(0,n.useState)([]),[r,c]=(0,n.useState)([]),[m,u]=(0,n.useState)(""),[x,h]=(0,n.useState)("CLASS"),[p,b]=(0,n.useState)(""),[v,j]=(0,n.useState)(""),[N,f]=(0,n.useState)(""),[w,C]=(0,n.useState)(!1),[k,S]=(0,n.useState)(!1),[I,Z]=(0,n.useState)(""),H=a.find(e=>String(e.id)===p),L=(null===H||void 0===H?void 0:H.schoolClasses)||[],D=L.find(e=>String(e.id)===v),K=(null===D||void 0===D?void 0:D.schoolSections)||[];(0,n.useEffect)(()=>{e.show&&e.instituteCode&&M()},[e.show,e.instituteCode]);const M=async()=>{C(!0);try{const[s,n,a]=await Promise.all([(0,z.bR)(),(0,d.$E)(e.instituteCode),(0,z.Kk)(e.instituteCode)]);t((s.data||[]).filter(e=>!1!==e.isActive)),l(n.data||[]),c(a.data||[])}catch(s){console.error("Failed to load data:",s)}finally{C(!1)}},R=e=>{const t=s.find(s=>s.id===e);return t&&(t.AssessmentName||t.assessmentName)||"ID: ".concat(e)},B=e=>{const s=[];if(e.sessionId){const t=a.find(s=>s.id===e.sessionId);t&&s.push(t.sessionYear)}if(e.classId)for(const t of a){const n=(t.schoolClasses||[]).find(s=>s.id===e.classId);if(n){if(s.push("Class ".concat(n.className)),e.sectionId){const t=(n.schoolSections||[]).find(s=>s.id===e.sectionId);t&&s.push("Section ".concat(t.sectionName))}break}}return s.join(" / ")||e.mappingLevel};return(0,y.jsxs)(P.Z,{show:e.show,onHide:e.onHide,size:"xl",centered:!0,children:[(0,y.jsx)(P.Z.Header,{closeButton:!0,children:(0,y.jsxs)(P.Z.Title,{children:["Assessment Mapping - ",e.instituteName]})}),(0,y.jsx)(P.Z.Body,{children:w?(0,y.jsxs)("div",{className:"text-center py-5",children:[(0,y.jsx)(E.Z,{animation:"border",size:"sm",className:"me-2"}),"Loading..."]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,y.jsx)("h6",{className:"mb-3",children:"Create New Mapping"}),(0,y.jsxs)("div",{className:"row g-3",children:[(0,y.jsxs)("div",{className:"col-md-4",children:[(0,y.jsx)(A.Z.Label,{children:"Assessment"}),(0,y.jsxs)(A.Z.Select,{value:m,onChange:e=>u(e.target.value),children:[(0,y.jsx)("option",{value:"",children:"Select Assessment"}),s.map(e=>(0,y.jsx)("option",{value:e.id,children:e.AssessmentName||e.assessmentName},e.id))]})]}),(0,y.jsxs)("div",{className:"col-md-2",children:[(0,y.jsx)(A.Z.Label,{children:"Level"}),(0,y.jsxs)(A.Z.Select,{value:x,onChange:e=>{h(e.target.value),j(""),f("")},children:[(0,y.jsx)("option",{value:"SESSION",children:"Session"}),(0,y.jsx)("option",{value:"CLASS",children:"Class"}),(0,y.jsx)("option",{value:"SECTION",children:"Section"})]})]}),(0,y.jsxs)("div",{className:"col-md-2",children:[(0,y.jsx)(A.Z.Label,{children:"Session"}),(0,y.jsxs)(A.Z.Select,{value:p,onChange:e=>{b(e.target.value),j(""),f("")},children:[(0,y.jsx)("option",{value:"",children:"Select Session"}),a.map(e=>(0,y.jsx)("option",{value:e.id,children:e.sessionYear},e.id))]})]}),("CLASS"===x||"SECTION"===x)&&(0,y.jsxs)("div",{className:"col-md-2",children:[(0,y.jsx)(A.Z.Label,{children:"Class"}),(0,y.jsxs)(A.Z.Select,{value:v,onChange:e=>{j(e.target.value),f("")},children:[(0,y.jsx)("option",{value:"",children:"Select Class"}),L.map(e=>(0,y.jsx)("option",{value:e.id,children:e.className},e.id))]})]}),"SECTION"===x&&(0,y.jsxs)("div",{className:"col-md-2",children:[(0,y.jsx)(A.Z.Label,{children:"Section"}),(0,y.jsxs)(A.Z.Select,{value:N,onChange:e=>f(e.target.value),children:[(0,y.jsx)("option",{value:"",children:"Select Section"}),K.map(e=>(0,y.jsx)("option",{value:e.id,children:e.sectionName},e.id))]})]})]}),(0,y.jsx)("div",{className:"mt-3",children:(0,y.jsx)(i.Z,{variant:"primary",size:"sm",onClick:async()=>{if(!m)return void alert("Please select an assessment");const s={assessmentId:Number(m),instituteCode:e.instituteCode,mappingLevel:x};if("SESSION"===x){if(!p)return void alert("Please select a session");s.sessionId=Number(p)}else if("CLASS"===x){if(!p||!v)return void alert("Please select a session and class");s.sessionId=Number(p),s.classId=Number(v)}else if("SECTION"===x){if(!p||!v||!N)return void alert("Please select a session, class, and section");s.sessionId=Number(p),s.classId=Number(v),s.sectionId=Number(N)}S(!0);try{await(0,z.Pm)(s);const t=await(0,z.Kk)(e.instituteCode);c(t.data||[]),u(""),b(""),j(""),f("")}catch(n){var t;console.error("Failed to create mapping:",n),alert("Failed to create mapping: "+((null===(t=n.response)||void 0===t?void 0:t.data)||n.message))}finally{S(!1)}},disabled:k,children:k?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(E.Z,{animation:"border",size:"sm",className:"me-1"}),"Creating..."]}):"Create Mapping"})})]}),(0,y.jsxs)("h6",{className:"mb-3",children:["Existing Mappings (",r.length,")"]}),0===r.length?(0,y.jsx)("div",{className:"text-muted text-center py-3",children:"No assessment mappings yet. Create one above."}):(0,y.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:(0,y.jsxs)("table",{className:"table table-striped table-hover table-sm",children:[(0,y.jsx)("thead",{className:"table-dark",style:{position:"sticky",top:0},children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"Assessment"}),(0,y.jsx)("th",{children:"Level"}),(0,y.jsx)("th",{children:"Details"}),(0,y.jsx)("th",{children:"Status"}),(0,y.jsx)("th",{children:"URL"}),(0,y.jsx)("th",{style:{width:"100px"},children:"Actions"})]})}),(0,y.jsx)("tbody",{children:r.map(e=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{children:R(e.assessmentId)}),(0,y.jsx)("td",{children:(0,y.jsx)(F.Z,{bg:"info",children:e.mappingLevel})}),(0,y.jsx)("td",{style:{fontSize:"0.85em"},children:B(e)}),(0,y.jsx)("td",{children:(0,y.jsx)(F.Z,{bg:e.isActive?"success":"secondary",style:{cursor:"pointer"},onClick:()=>(async e=>{try{await(0,z.XM)(e.mappingId,{isActive:!e.isActive}),c(r.map(s=>s.mappingId===e.mappingId?(0,g.Z)((0,g.Z)({},s),{},{isActive:!s.isActive}):s))}catch(s){console.error("Failed to update mapping:",s)}})(e),children:e.isActive?"Active":"Inactive"})}),(0,y.jsx)("td",{children:(0,y.jsxs)(i.Z,{variant:"outline-primary",size:"sm",onClick:()=>{return s=e.token,navigator.clipboard.writeText((e=>"".concat("https://assessment.career-9.com","/assessment-register/").concat(e))(s)),Z(s),void setTimeout(()=>Z(""),2e3);var s},title:"Copy URL",children:[(0,y.jsx)(o.Fqs,{size:14}),I===e.token?(0,y.jsx)("span",{className:"ms-1",style:{fontSize:"0.8em"},children:"Copied!"}):(0,y.jsx)("span",{className:"ms-1",style:{fontSize:"0.8em"},children:"Copy"})]})}),(0,y.jsx)("td",{children:(0,y.jsx)(i.Z,{variant:"outline-danger",size:"sm",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this mapping?"))try{await(0,z.zW)(e),c(r.filter(s=>s.mappingId!==e))}catch(s){console.error("Failed to delete mapping:",s)}})(e.mappingId),children:(0,y.jsx)(o.ZkW,{size:14})})})]},e.mappingId))})]})})]})}),(0,y.jsx)(P.Z.Footer,{children:(0,y.jsx)(i.Z,{variant:"secondary",onClick:e.onHide,children:"Close"})})]})},L=e=>{var s,t;const[r,g]=(0,n.useState)(!1),[v,j]=(0,n.useState)({instituteName:"",instituteAddress:"",instituteCode:""}),[N,f]=(0,n.useState)(!1),[C,k]=(0,n.useState)(void 0),[I,P]=(0,n.useState)(!1),[E,A]=(0,n.useState)(void 0),[F,z]=(0,n.useState)(!1),[L,D]=(0,n.useState)(void 0),[K,M]=(0,n.useState)(!1),[R,B]=(0,n.useState)({code:0,name:""}),T=(0,a.s0)(),U=e=>{var s,t,n,a;let i;return i="boolean"===typeof e.display?e.display?1:0:e.display,{instituteName:null!==(s=e.instituteName)&&void 0!==s?s:"",instituteAddress:null!==(t=e.instituteAddress)&&void 0!==t?t:"",instituteCode:null!==(n=e.instituteCode)&&void 0!==n?n:"",display:i,questionOptions:null!==(a=e.questionOptions)&&void 0!==a?a:[""],contactPersons:e.contactPersons&&Array.isArray(e.contactPersons)&&e.contactPersons.length?e.contactPersons:[{name:"",email:"",phone:"",gender:"",designation:""}]}},_={columns:[{label:"Name",field:"name",width:150,attributes:{"aria-controls":"DataTable","aria-label":"Name"}},{label:"Code",field:"code",sort:"asc",width:100},{label:"Address",field:"address",width:100},{label:"Actions",field:"actions",sort:"disabled",width:150}],rows:null!==(s=(null!==(t=e.data)&&void 0!==t?t:[]).filter(e=>!!e&&("boolean"===typeof e.display?!0===e.display:"number"===typeof e.display?0!==e.display:"string"===typeof e.display?"0"!==e.display&&"false"!==e.display:Boolean(e.display))).map(s=>{var t,n,a;return{name:null!==(t=s.instituteName)&&void 0!==t?t:"",code:null!==(n=s.instituteCode)&&void 0!==n?n:"",address:null!==(a=s.instituteAddress)&&void 0!==a?a:"",actions:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{type:"button",onClick:()=>{j(s),g(!0)},className:"btn btn-icon btn-primary btn-sm me-3",children:(0,y.jsx)(m.QML,{size:16})}),(0,y.jsx)("button",{type:"button",onClick:async()=>{try{var t;const n=null!==(t=s.id)&&void 0!==t?t:s.instituteCode;if(console.log("Attempting to delete college. Row:",s),console.log("Using deleteId:",n),!n)return console.error("No 'id' or 'instituteCode' found on this row. Cannot call DeleteCollegeData."),void alert("Cannot delete: no valid ID found for this record.");e.setLoading(!0),await(0,d.eh)(n),e.setPageLoading(e=>!e)}catch(n){console.error("Delete failed:",n),alert("Delete failed. Check console for details.")}finally{e.setLoading(!1)}},className:"btn btn-icon btn-danger btn-sm me-3",children:(0,y.jsx)(x.Z,{animation:h.Z,size:22,strokeColor:"#EFF8FE"})}),(0,y.jsxs)(p.Z,{className:"d-inline",children:[(0,y.jsx)(p.Z.Toggle,{variant:"success",size:"sm",id:"dropdown-".concat(s.instituteCode),className:"dropdown-toggle",children:"Actions"}),(0,y.jsxs)(p.Z.Menu,{style:{minWidth:"150px",zIndex:1050},popperConfig:{strategy:"fixed"},renderOnMount:!0,children:[(0,y.jsx)(u.rU,{to:"/course",state:{collegeId:s.instituteCode,college:s.instituteName},style:{textDecoration:"none"},children:(0,y.jsxs)(p.Z.Item,{as:"button",children:[(0,y.jsx)(m.ocf,{size:18,className:"me-2"}),"Add Course"]})}),(0,y.jsxs)(p.Z.Item,{onClick:()=>{k(U(s)),f(!0)},children:[(0,y.jsx)(m.ocf,{size:18,className:"me-2"}),"Info"]}),(0,y.jsxs)(p.Z.Item,{onClick:()=>{A(U(s)),P(!0)},children:[(0,y.jsx)(m.ocf,{size:18,className:"me-2"}),"Add Details"]}),(0,y.jsxs)(p.Z.Item,{onClick:()=>{D(U(s)),z(!0)},children:[(0,y.jsx)(m.ocf,{size:18,className:"me-2"}),"Assign Roles"]}),(0,y.jsxs)(p.Z.Item,{onClick:()=>{B({code:Number(s.instituteCode),name:s.instituteName||""}),M(!0)},children:[(0,y.jsx)(o.eAf,{size:18,className:"me-2"}),"Assessment Mapping"]})]})]}),(0,y.jsxs)(i.Z,{variant:"outline-info",size:"sm",className:"me-2",onClick:()=>T("/school/dashboard/".concat(s.instituteCode||s.id)),children:[(0,y.jsx)(l.Pd.Provider,{value:{style:{paddingBottom:"3px"}},children:(0,y.jsx)(o.JZ9,{})}),(0,y.jsx)("span",{style:{marginLeft:6},children:"Dashboard"})]})]})}}))&&void 0!==s?s:[]};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("style",{children:"\n        .college-table-wrapper table tbody tr {\n          position: relative;\n        }\n        .college-table-wrapper table tbody tr:has(.dropdown-menu.show) {\n          z-index: 10;\n        }\n        .college-table-wrapper .dropdown-menu.show {\n          position: fixed !important;\n          z-index: 1050 !important;\n        }\n      "}),(0,y.jsx)("div",{className:"college-table-wrapper",style:{overflow:"visible"},children:(0,y.jsx)(c.Vm4,{hover:!0,entriesOptions:[5,20,25],entries:25,pagesAmount:4,data:_})}),(0,y.jsx)(b.default,{show:r,onHide:()=>g(!1),data:v,setPageLoading:e.setPageLoading}),(0,y.jsx)(w,{show:N,onHide:()=>f(!1),data:C,setPageLoading:e.setPageLoading}),(0,y.jsx)(Z,{show:I,onHide:()=>P(!1),data:E,setPageLoading:e.setPageLoading}),(0,y.jsx)(S,{show:F,onHide:()=>z(!1),data:L,setPageLoading:e.setPageLoading}),(0,y.jsx)(H,{show:K,onHide:()=>M(!1),instituteCode:R.code,instituteName:R.name})]})},D=e=>{let{show:s,onHide:t,college:a,onUploaded:l}=e;const[o,d]=(0,n.useState)(null),[r,c]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null);return(0,y.jsxs)(P.Z,{show:s,onHide:t,size:"lg",centered:!0,children:[(0,y.jsx)(P.Z.Header,{closeButton:!0,children:(0,y.jsx)(P.Z.Title,{children:"Upload Students Excel"})}),(0,y.jsx)(P.Z.Body,{children:(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("strong",{children:"Institute:"})," ",(null===a||void 0===a?void 0:a.instituteName)||"\u2014"]}),(0,y.jsxs)(A.Z.Group,{className:"mt-3",children:[(0,y.jsx)(A.Z.Label,{children:"Student file (.xlsx, .xls, .csv)"}),(0,y.jsx)(A.Z.Control,{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{var s;d((null===(s=e.target.files)||void 0===s?void 0:s[0])||null)}}),(0,y.jsx)(A.Z.Text,{className:"text-muted",children:"First row should contain headers (name, email, rollNo etc.)"})]}),m&&(0,y.jsx)("div",{className:"mt-2",children:m})]})}),(0,y.jsxs)(P.Z.Footer,{children:[(0,y.jsx)(i.Z,{variant:"secondary",onClick:t,disabled:r,children:"Close"}),(0,y.jsx)(i.Z,{variant:"primary",onClick:async()=>{if(o&&a){c(!0),u(null);try{const e=new FormData;e.append("file",o);if(!(await fetch("/api/colleges/".concat(a.instituteCode||a.id,"/students/upload"),{method:"POST",body:e})).ok)throw new Error("Upload failed");u("Uploaded successfully"),l&&l()}catch(e){console.error(e),u("Upload failed")}finally{c(!1)}}else u("Please select a file and institute.")},disabled:r||!o,children:r?"Uploading\u2026":"Upload"})]})]})},K=()=>{const[e,s]=(0,n.useState)(!1),[t,c]=(0,n.useState)([]),[m,u]=(0,n.useState)(!1),[x,h]=(0,n.useState)(["false"]),[p,b]=(0,n.useState)(!1),[g,v]=(0,n.useState)(null);(0,a.s0)();(0,n.useEffect)(()=>{u(!0);try{(0,d.hi)().then(e=>{c(e.data),u(!1)})}catch(e){console.error(e)}},[x]);return(0,y.jsxs)("div",{className:"card",children:[m&&(0,y.jsxs)("span",{className:"indicator-progress m-5",style:{display:"block"},children:["Please wait..."," ",(0,y.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]}),!m&&(0,y.jsxs)("div",{className:"card-header border-0 pt-6",children:[(0,y.jsx)("div",{className:"card-title",children:(0,y.jsx)("h1",{children:"Institutes List"})}),(0,y.jsx)("div",{className:"card-toolbar",children:(0,y.jsx)("div",{className:"d-flex justify-content-end",children:(0,y.jsx)("div",{style:{display:"flex",gap:8},children:(0,y.jsx)(i.Z,{variant:"primary",onClick:()=>{s(!0)},children:(0,y.jsx)(l.Pd.Provider,{value:{style:{paddingBottom:"4px"}},children:(0,y.jsxs)("div",{children:["Add Institute ",(0,y.jsx)(o.eAf,{size:21})]})})})})})})]}),!m&&(0,y.jsx)("div",{className:"card-body pt-5",children:(0,y.jsx)(L,{data:t,setLoading:u,setPageLoading:h,onUploadClick:e=>{v(e),b(!0)}})}),(0,y.jsx)(r.Z,{setPageLoading:h,show:e,onHide:()=>s(!1)}),(0,y.jsx)(D,{show:p,onHide:()=>b(!1),college:g,onUploaded:()=>{b(!1),v(null),h([String(Date.now())])}})]})}},62094:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var n=t(1413),a=t(28182),i=t(92506),l=t(72791),o=t(28403),d=t(70099),r=t(7755),c=t(81724),m=t(54624),u=t(80184);const x=c.Ry().shape({instituteName:c.Z_().required(),instituteAddress:c.Z_().required(),instituteCode:c.Z_().required(),maxStudents:c.Z_().required(),maxContactPersons:c.Z_().required()}),h=e=>{const[s,t]=(0,l.useState)(!1);var c={instituteName:e.data.instituteName,instituteAddress:e.data.instituteAddress,instituteCode:e.data.instituteCode,maxStudents:e.data.maxStudents,maxContactPersons:e.data.maxContactPersons,display:1};const h=(0,i.TA)({enableReinitialize:!0,initialValues:c,validationSchema:x,onSubmit:s=>{try{t(!0),(0,m.J6)(s).then(()=>{e.onHide(!1),e.setPageLoading(["true"])})}catch(n){console.error(n),window.location.replace("/error")}}});return(0,u.jsxs)(o.Z,(0,n.Z)((0,n.Z)({},e),{},{"aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[(0,u.jsxs)(o.Z.Header,{children:[(0,u.jsx)(o.Z.Title,{children:(0,u.jsx)("h1",{children:"Edit College"})}),(0,u.jsx)("div",{className:"btn btn-sm btn-icon btn-active-color-primary",onClick:e.onHide,children:(0,u.jsx)(d.Z,{animation:r.Z,size:28,strokeColor:"#181C32",reverse:!0})})]}),(0,u.jsxs)("form",{className:"form w-100 fv-plugins-bootstrap5 fv-plugins-framework",onSubmit:h.handleSubmit,children:[(0,u.jsx)(o.Z.Body,{children:(0,u.jsx)("div",{className:"modal-body",children:(0,u.jsxs)("div",{className:"scroll-y me-n7 pe-7",id:"kt_modal_add_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_header","data-kt-scroll-wrappers":"#kt_modal_add_scroll","data-kt-scroll-offset":"300px",children:[(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"fs-6 fw-bold mb-2",children:"Institute Code :"}),(0,u.jsx)("input",(0,n.Z)((0,n.Z)({placeholder:"Enter Institute Code",type:"text",autoComplete:"off"},h.getFieldProps("instituteCode")),{},{className:"form-control form-control-lg form-control-solid",disabled:!0}))]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"College Name :"}),(0,u.jsx)("input",(0,n.Z)((0,n.Z)({placeholder:"Enter College Name",type:"text",autoComplete:"off"},h.getFieldProps("instituteName")),{},{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":h.touched.instituteName&&h.errors.instituteName},{"is-valid":h.touched.instituteName&&!h.errors.instituteName})})),h.touched.instituteName&&h.errors.instituteName&&(0,u.jsx)("div",{className:"fv-plugins-message-container",children:(0,u.jsx)("div",{className:"fv-help-block text-danger",children:(0,u.jsx)("span",{role:"alert",children:"College Name is Required"})})})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Institute Address :"}),(0,u.jsx)("input",(0,n.Z)((0,n.Z)({placeholder:"Enter Institute Address",type:"text",autoComplete:"off"},h.getFieldProps("instituteAddress")),{},{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":h.touched.instituteAddress&&h.errors.instituteAddress},{"is-valid":h.touched.instituteAddress&&!h.errors.instituteAddress})})),h.touched.instituteAddress&&h.errors.instituteAddress&&(0,u.jsx)("div",{className:"fv-plugins-message-container",children:(0,u.jsx)("div",{className:"fv-help-block text-danger",children:(0,u.jsx)("span",{role:"alert",children:"Institute Address is Required"})})})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Maximum Students :"}),(0,u.jsx)("input",(0,n.Z)((0,n.Z)({placeholder:"Enter Maximum Students",type:"text",autoComplete:"off"},h.getFieldProps("maxStudents")),{},{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":h.touched.maxStudents&&!!h.errors.maxStudents},{"is-valid":h.touched.maxStudents&&!h.errors.maxStudents})})),h.touched.maxStudents&&h.errors.maxStudents&&(0,u.jsx)("div",{className:"fv-plugins-message-container",children:(0,u.jsx)("div",{className:"fv-help-block text-danger",children:(0,u.jsx)("span",{role:"alert",children:"Maximum Students is Required"})})})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Maximum Contact Persons :"}),(0,u.jsx)("input",(0,n.Z)((0,n.Z)({placeholder:"Enter Maximum Contact Persons",type:"text",autoComplete:"off"},h.getFieldProps("maxContactPersons")),{},{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":h.touched.maxContactPersons&&!!h.errors.maxContactPersons},{"is-valid":h.touched.maxContactPersons&&!h.errors.maxContactPersons})})),h.touched.maxContactPersons&&h.errors.maxContactPersons&&(0,u.jsx)("div",{className:"fv-plugins-message-container",children:(0,u.jsx)("div",{className:"fv-help-block text-danger",children:(0,u.jsx)("span",{role:"alert",children:"Maximum Contact Persons is Required"})})})]})]})})}),(0,u.jsxs)(o.Z.Footer,{children:[(0,u.jsx)("button",{className:"btn btn-sm btn-light btn-active-light-secoundary",onClick:e.onHide,children:"Close"}),(0,u.jsxs)("button",{type:"submit",id:"kt_sign_up_submit",className:"btn btn-sm btn-primary btn-active-light-secoundary",disabled:h.isSubmitting||!h.isValid,children:[!s&&(0,u.jsx)("span",{className:"indicator-label",children:"Submit"}),s&&(0,u.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait..."," ",(0,u.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})]}))}},21799:(e,s,t)=>{t.d(s,{Z:()=>h});var n=t(87462),a=t(63366),i=t(81694),l=t.n(i),o=t(72791),d=t(89181);const r=function(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(function(e){return null!=e}).reduce(function(e,s){if("function"!==typeof s)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?s:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];e.apply(this,n),s.apply(this,n)}},null)};function c(e){return!e||"#"===e.trim()}var m=o.forwardRef(function(e,s){var t=e.as,i=void 0===t?"a":t,l=e.disabled,d=e.onKeyDown,m=(0,a.Z)(e,["as","disabled","onKeyDown"]),u=function(e){var s=m.href,t=m.onClick;(l||c(s))&&e.preventDefault(),l?e.stopPropagation():t&&t(e)};return c(m.href)&&(m.role=m.role||"button",m.href=m.href||"#"),l&&(m.tabIndex=-1,m["aria-disabled"]=!0),o.createElement(i,(0,n.Z)({ref:s},m,{onClick:u,onKeyDown:r(function(e){" "===e.key&&(e.preventDefault(),u(e))},d)}))});m.displayName="SafeAnchor";const u=m;var x=o.forwardRef(function(e,s){var t=e.bsPrefix,i=e.variant,r=e.size,c=e.active,m=e.className,x=e.block,h=e.type,p=e.as,b=(0,a.Z)(e,["bsPrefix","variant","size","active","className","block","type","as"]),g=(0,d.vE)(t,"btn"),v=l()(m,g,c&&"active",i&&g+"-"+i,x&&g+"-block",r&&g+"-"+r);if(b.href)return o.createElement(u,(0,n.Z)({},b,{as:p,ref:s,className:l()(v,b.disabled&&"disabled")}));s&&(b.ref=s),h?b.type=h:p||(b.type="button");var j=p||"button";return o.createElement(j,(0,n.Z)({},b,{className:v}))});x.displayName="Button",x.defaultProps={variant:"primary",active:!1,disabled:!1};const h=x}}]);
//# sourceMappingURL=95.2cfa170b.chunk.js.map