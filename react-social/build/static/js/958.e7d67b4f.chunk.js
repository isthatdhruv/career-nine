"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[958],{15110:(e,s,n)=>{n.d(s,{Kk:()=>o,Pm:()=>i,XM:()=>l,bR:()=>d,eF:()=>u,zV:()=>m,zW:()=>c});var t=n(74569),a=n.n(t);const r="https://api.career-9.com";function i(e){return a().post("".concat(r,"/assessment-mapping/create"),e)}function o(e){return a().get("".concat(r,"/assessment-mapping/getByInstitute/").concat(e))}function l(e,s){return a().put("".concat(r,"/assessment-mapping/update/").concat(e),s)}function c(e){return a().delete("".concat(r,"/assessment-mapping/delete/").concat(e))}function d(){return a().get("".concat(r,"/assessments/get/list-summary"))}function u(e){return a().get("".concat(r,"/assessment-mapping/public/info/").concat(e))}function m(e,s){return a().post("".concat(r,"/assessment-mapping/public/register/").concat(e),s)}},94958:(e,s,n)=>{n.r(s),n.d(s,{default:()=>F});var t=n(1413),a=n(72791),r=n(4437),i=n(24849),o=n(45736),l=n(43360),c=n(45987),d=n(95627),u=n.n(d),m=n(80239),h=n(52134),p=n(69311),x=n(10162),g=n(72709),f=n(80473),v=n(27472),b=n(4462),j=n(80184);const N=["bsPrefix","show","closeLabel","closeVariant","className","children","variant","onClose","dismissible","transition"],I=(0,v.Z)("h4");I.displayName="DivStyledAsH4";const y=(0,b.Z)("alert-heading",{Component:I}),w=(0,b.Z)("alert-link",{Component:p.Z}),S={variant:"primary",show:!0,transition:g.Z,closeLabel:"Close alert"},Z=a.forwardRef((e,s)=>{const n=(0,m.Ch)(e,{show:"onClose"}),{bsPrefix:a,show:r,closeLabel:i,closeVariant:o,className:l,children:d,variant:p,onClose:v,dismissible:b,transition:I}=n,y=(0,c.Z)(n,N),w=(0,x.vE)(a,"alert"),S=(0,h.Z)(e=>{v&&v(!1,e)}),Z=!0===I?g.Z:I,C=(0,j.jsxs)("div",(0,t.Z)((0,t.Z)({role:"alert"},Z?void 0:y),{},{ref:s,className:u()(l,w,p&&"".concat(w,"-").concat(p),b&&"".concat(w,"-dismissible")),children:[b&&(0,j.jsx)(f.Z,{onClick:S,"aria-label":i,variant:o}),d]}));return Z?(0,j.jsx)(Z,(0,t.Z)((0,t.Z)({unmountOnExit:!0},y),{},{ref:void 0,in:r,children:C})):r?C:null});Z.displayName="Alert",Z.defaultProps=S;const C=Object.assign(Z,{Link:w,Heading:y});var k=n(34045),q=n(54624),H=n(15110),Q=n(74569),E=n.n(Q);const L="https://api.career-9.com";const F=()=>{var e;const[s,n]=(0,a.useState)([]),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(!1),[b,N]=(0,a.useState)(null),[I,y]=(0,a.useState)(!1),[w,S]=(0,a.useState)([]),[Z,Q]=(0,a.useState)(""),F=(0,a.useRef)(null),[_,A]=(0,a.useState)(!1),[z,P]=(0,a.useState)(null);(0,a.useEffect)(()=>{O()},[]);const O=async()=>{g(!0);try{const e=await(0,q.hi)();n(e.data||[])}catch(e){console.error("Failed to load institutes:",e)}finally{g(!1)}};(0,a.useEffect)(()=>{c?R(Number(c)):(m([]),p(""),N(null),S([]))},[c]);const R=async e=>{v(!0),p(""),N(null),S([]);try{const[s,n]=await Promise.all([(0,H.Kk)(e),(0,H.bR)()]),t=s.data||[],a=n.data||[],r=new Set(t.map(e=>e.assessmentId)),i=a.filter(e=>r.has(e.id));m(i)}catch(s){console.error("Failed to load assessments:",s)}finally{v(!1)}};(0,a.useEffect)(()=>{h?U(Number(h)):(N(null),S([]))},[h]);const U=async e=>{y(!0),S([]),P(null);try{const s=await function(e){return E().get("".concat(L,"/assessment-answer/offline-mapping/").concat(e))}(e);N(s.data)}catch(s){console.error("Failed to load mapping:",s),alert("Failed to load assessment mapping. Make sure the assessment has a linked questionnaire.")}finally{y(!1)}},D={};if(b)for(const t of b.questions)t.excelQuestionHeader&&(D[t.excelQuestionHeader]=t);const T=u,W=(e,s)=>{if(null===e||void 0===e||""===e)return{optionId:null};const n=String(e).trim();if(""===n)return{optionId:null};const t=s.options;if(!t||0===t.length)return{optionId:null,error:"No options defined"};const a=Number(n);if(!isNaN(a)&&Number.isInteger(a)&&a>=1){const e=t.find(e=>e.sequence===a);return e?{optionId:e.optionId}:{optionId:null,error:"Sequence ".concat(a," out of range (max ").concat(t.length,")")}}const r=n.toUpperCase();if(/^[A-Z]$/.test(r)){const e=r.charCodeAt(0)-64,s=t.find(s=>s.sequence===e);return s?{optionId:s.optionId}:{optionId:null,error:"Letter ".concat(r," out of range (max ").concat(t.length," options)")}}const i=n.toLowerCase();if("yes"===i||"y"===i){const e=t.find(e=>1===e.sequence);return e?{optionId:e.optionId}:{optionId:null,error:"No first option for Yes"}}if("no"===i||"n"===i){const e=t.find(e=>2===e.sequence);return e?{optionId:e.optionId}:{optionId:null,error:"No second option for No"}}return{optionId:null,error:'Unrecognized value: "'.concat(n,'"')}},M=b?b.questions.filter(e=>e.excelQuestionHeader):[];return(0,j.jsxs)("div",{className:"card",children:[(0,j.jsx)("div",{className:"card-header",children:(0,j.jsx)("h3",{className:"card-title",children:"Offline Assessment Data Upload"})}),(0,j.jsxs)("div",{className:"card-body",children:[(0,j.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,j.jsx)("h6",{className:"mb-3",children:"Select School & Assessment"}),(0,j.jsxs)("div",{className:"row g-3 align-items-end",children:[(0,j.jsxs)("div",{className:"col-md-5",children:[(0,j.jsx)(r.Z.Label,{children:"School / Institute"}),x?(0,j.jsxs)("div",{children:[(0,j.jsx)(i.Z,{animation:"border",size:"sm"})," Loading..."]}):(0,j.jsxs)(r.Z.Select,{value:c,onChange:e=>d(e.target.value),children:[(0,j.jsx)("option",{value:"",children:"Select an institute..."}),s.map(e=>(0,j.jsx)("option",{value:e.instituteCode,children:e.instituteName},e.instituteCode))]})]}),(0,j.jsxs)("div",{className:"col-md-5",children:[(0,j.jsx)(r.Z.Label,{children:"Assessment"}),f?(0,j.jsxs)("div",{children:[(0,j.jsx)(i.Z,{animation:"border",size:"sm"})," Loading..."]}):(0,j.jsxs)(r.Z.Select,{value:h,onChange:e=>p(e.target.value),disabled:!c,children:[(0,j.jsx)("option",{value:"",children:"Select an assessment..."}),T.map(e=>(0,j.jsx)("option",{value:e.id,children:e.assessmentName},e.id))]})]}),(0,j.jsx)("div",{className:"col-md-2",children:I&&(0,j.jsx)(i.Z,{animation:"border",size:"sm",className:"ms-2"})})]}),b&&(0,j.jsxs)("div",{className:"mt-3",children:[(0,j.jsxs)(o.Z,{bg:"success",className:"me-2",children:["Questionnaire: ",b.questionnaireName]}),(0,j.jsxs)(o.Z,{bg:"info",children:[b.questions.length," questions mapped"]})]})]}),b&&(0,j.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,j.jsx)("h6",{className:"mb-3",children:"Template & Upload"}),(0,j.jsxs)("div",{className:"row g-3 align-items-end",children:[(0,j.jsx)("div",{className:"col-md-4",children:(0,j.jsxs)(l.Z,{variant:"outline-primary",onClick:()=>{if(!b)return;const e=["userId"];for(const t of b.questions)t.excelQuestionHeader&&e.push(t.excelQuestionHeader);const s=k.utils.aoa_to_sheet([e]),n=k.utils.book_new();k.utils.book_append_sheet(n,s,"Data"),k.writeFile(n,"offline_template_".concat(b.assessmentName.replace(/\s+/g,"_"),".xlsx"))},children:[(0,j.jsx)("i",{className:"bi bi-download me-2"}),"Download Excel Template"]})}),(0,j.jsxs)("div",{className:"col-md-6",children:[(0,j.jsx)(r.Z.Label,{children:"Upload Filled Excel"}),(0,j.jsx)(r.Z.Control,{type:"file",accept:".xlsx,.xls",ref:F,onChange:e=>{var s;const n=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!n||!b)return;Q(n.name),P(null);const t=new FileReader;t.onload=e=>{var s;const n=null===(s=e.target)||void 0===s?void 0:s.result,t=k.read(n,{type:"binary"}),a=t.SheetNames[0],r=t.Sheets[a],i=k.utils.sheet_to_json(r,{defval:""}).map(e=>{const s=void 0!==e.userId&&""!==e.userId?Number(e.userId):null,n={},t={};for(const a of b.questions){const s=a.excelQuestionHeader;if(!s)continue;const r=e[s],i=W(r,a);n[s]=i.optionId,i.error&&(t[s]=i.error)}return{userId:s,answers:n,errors:t,userIdError:null===s?"Missing userId":void 0}});S(i)},t.readAsBinaryString(n)}})]}),(0,j.jsx)("div",{className:"col-md-2",children:Z&&(0,j.jsx)("small",{className:"text-muted",children:Z})})]})]}),w.length>0&&b&&(0,j.jsxs)("div",{className:"mb-4",children:[(0,j.jsxs)("h6",{className:"mb-3",children:["Preview (",w.length," students)",w.some(e=>Object.keys(e.errors).length>0)&&(0,j.jsx)(o.Z,{bg:"warning",className:"ms-2",children:"Has errors"})]}),(0,j.jsx)("div",{className:"table-responsive",style:{maxHeight:"500px"},children:(0,j.jsxs)("table",{className:"table table-bordered table-sm table-hover",children:[(0,j.jsx)("thead",{className:"table-dark",style:{position:"sticky",top:0},children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{style:{minWidth:"50px"},children:"#"}),(0,j.jsx)("th",{style:{minWidth:"120px"},children:"userId"}),M.map(e=>(0,j.jsx)("th",{style:{minWidth:"150px"},title:e.questionText,children:e.excelQuestionHeader},e.excelQuestionHeader))]})}),(0,j.jsx)("tbody",{children:w.map((e,s)=>{var n;return(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:s+1}),(0,j.jsx)("td",{className:e.userIdError?"table-danger":"",children:(0,j.jsx)("input",{type:"number",className:"form-control form-control-sm",value:null!==(n=e.userId)&&void 0!==n?n:"",onChange:e=>{return n=s,a=e.target.value,void S(e=>{const s=[...e],r=""===a?null:Number(a);return s[n]=(0,t.Z)((0,t.Z)({},s[n]),{},{userId:r,userIdError:null===r||isNaN(r)?"Invalid userId":void 0}),s});var n,a},style:{width:"100px"}})}),M.map(n=>{const a=n.excelQuestionHeader,r=e.answers[a],i=!!e.errors[a],o=null===r&&!i;return(0,j.jsx)("td",{className:i?"table-danger":o?"table-warning":"",title:e.errors[a]||"",children:(0,j.jsxs)("select",{className:"form-select form-select-sm",value:null!==r&&void 0!==r?r:"",onChange:e=>((e,s,n)=>{S(a=>{const r=[...a],i=(0,t.Z)({},r[e]);i.answers=(0,t.Z)((0,t.Z)({},i.answers),{},{[s]:n});const o=(0,t.Z)({},i.errors);return delete o[s],i.errors=o,r[e]=i,r})})(s,a,""===e.target.value?null:Number(e.target.value)),children:[(0,j.jsx)("option",{value:"",children:"-- Skip --"}),n.options.map(e=>(0,j.jsx)("option",{value:e.optionId,children:e.optionText},e.optionId))]})},a)})]},s)})})]})})]}),w.length>0&&b&&(0,j.jsx)("div",{className:"card card-body bg-light",children:(0,j.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,j.jsx)(l.Z,{variant:"success",size:"lg",onClick:async()=>{if(!b||0===w.length)return;const e=w.filter(e=>null===e.userId||e.userIdError);if(e.length>0)return void alert("".concat(e.length," row(s) have invalid or missing userId. Please fix them before submitting."));const s=w.filter(e=>Object.keys(e.errors).length>0);if(!(s.length>0)||window.confirm("".concat(s.length," row(s) have parsing errors. Cells with errors will be skipped. Continue?"))){A(!0),P(null);try{const e=w.map(e=>{const s=[];for(const n of b.questions){const t=n.excelQuestionHeader;if(!t)continue;const a=e.answers[t];null!==a&&void 0!==a&&s.push({questionnaireQuestionId:n.questionnaireQuestionId,optionId:a})}return{userStudentId:e.userId,answers:s}}),s=await(t={assessmentId:b.assessmentId,students:e},E().post("".concat(L,"/assessment-answer/bulk-submit"),t));P(s.data)}catch(a){var n;console.error("Submit failed:",a),P({status:"error",message:(null===(n=a.response)||void 0===n?void 0:n.data)||a.message})}finally{A(!1)}var t}},disabled:_,children:_?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(i.Z,{animation:"border",size:"sm",className:"me-2"}),"Submitting..."]}):(0,j.jsxs)(j.Fragment,{children:["Submit All (",w.length," students)"]})}),z&&"success"===z.status&&(0,j.jsxs)(C,{variant:"success",className:"mb-0 flex-grow-1",children:["Successfully processed"," ",(0,j.jsx)("strong",{children:z.studentsProcessed})," students.",(null===(e=z.errors)||void 0===e?void 0:e.length)>0&&(0,j.jsxs)("span",{className:"text-danger ms-2",children:[z.errors.length," error(s):",z.errors.map((e,s)=>(0,j.jsxs)("div",{children:["Student ",e.userStudentId,": ",e.error]},s))]})]}),z&&"error"===z.status&&(0,j.jsxs)(C,{variant:"danger",className:"mb-0 flex-grow-1",children:["Submission failed: ",z.message]})]})})]})]})}}}]);
//# sourceMappingURL=958.e7d67b4f.chunk.js.map