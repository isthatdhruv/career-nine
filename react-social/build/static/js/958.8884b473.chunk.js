"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[958],{15110:(e,s,t)=>{t.d(s,{Kk:()=>a,Pm:()=>i,XM:()=>l,bR:()=>d,eF:()=>u,zV:()=>m,zW:()=>c});var n=t(74569),r=t.n(n);const o="https://api.career-9.com";function i(e){return r().post("".concat(o,"/assessment-mapping/create"),e)}function a(e){return r().get("".concat(o,"/assessment-mapping/getByInstitute/").concat(e))}function l(e,s){return r().put("".concat(o,"/assessment-mapping/update/").concat(e),s)}function c(e){return r().delete("".concat(o,"/assessment-mapping/delete/").concat(e))}function d(){return r().get("".concat(o,"/assessments/get/list-summary"))}function u(e){return r().get("".concat(o,"/assessment-mapping/public/info/").concat(e))}function m(e,s){return r().post("".concat(o,"/assessment-mapping/public/register/").concat(e),s)}},94958:(e,s,t)=>{t.r(s),t.d(s,{default:()=>R});var n=t(1413),r=t(72791),o=t(4437),i=t(24849),a=t(45736),l=t(43360),c=t(45987),d=t(95627),u=t.n(d),m=t(80239),h=t(52134),p=t(69311),b=t(10162),x=t(72709),f=t(80473),g=t(27472),j=t(4462),v=t(80184);const N=["bsPrefix","show","closeLabel","closeVariant","className","children","variant","onClose","dismissible","transition"],y=(0,g.Z)("h4");y.displayName="DivStyledAsH4";const w=(0,j.Z)("alert-heading",{Component:y}),q=(0,j.Z)("alert-link",{Component:p.Z}),S={variant:"primary",show:!0,transition:x.Z,closeLabel:"Close alert"},C=r.forwardRef((e,s)=>{const t=(0,m.Ch)(e,{show:"onClose"}),{bsPrefix:r,show:o,closeLabel:i,closeVariant:a,className:l,children:d,variant:p,onClose:g,dismissible:j,transition:y}=t,w=(0,c.Z)(t,N),q=(0,b.vE)(r,"alert"),S=(0,h.Z)(e=>{g&&g(!1,e)}),C=!0===y?x.Z:y,I=(0,v.jsxs)("div",(0,n.Z)((0,n.Z)({role:"alert"},C?void 0:w),{},{ref:s,className:u()(l,q,p&&"".concat(q,"-").concat(p),j&&"".concat(q,"-dismissible")),children:[j&&(0,v.jsx)(f.Z,{onClick:S,"aria-label":i,variant:a}),d]}));return C?(0,v.jsx)(C,(0,n.Z)((0,n.Z)({unmountOnExit:!0},w),{},{ref:void 0,in:o,children:I})):o?I:null});C.displayName="Alert",C.defaultProps=S;const I=Object.assign(C,{Link:q,Heading:w});var Z=t(34045),k=t(54624),Q=t(15110),M=t(74569),z=t.n(M);const T="https://api.career-9.com";const E=(e,s)=>{if(null===e||void 0===e||""===e)return{optionId:null};const t=String(e).trim();if(""===t)return{optionId:null};if(!s||0===s.length)return{optionId:null,error:"No options defined"};const n=Number(t);if(!isNaN(n)&&Number.isInteger(n)&&n>=1){const e=s.find(e=>e.sequence===n);return e?{optionId:e.optionId}:{optionId:null,error:"Sequence ".concat(n," out of range (max ").concat(s.length,")")}}const r=t.toUpperCase();if(/^[A-Z]$/.test(r)){const e=r.charCodeAt(0)-64,t=s.find(s=>s.sequence===e);return t?{optionId:t.optionId}:{optionId:null,error:"Letter ".concat(r," out of range (max ").concat(s.length," options)")}}const o=t.toLowerCase();if("yes"===o||"y"===o){const e=s.find(e=>1===e.sequence);if(e)return{optionId:e.optionId}}if("no"===o||"n"===o){const e=s.find(e=>2===e.sequence);if(e)return{optionId:e.optionId}}return{optionId:null,error:'Unrecognized value: "'.concat(t,'"')}},R=()=>{var e,s;const[t,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[m,h]=(0,r.useState)([]),[p,b]=(0,r.useState)(""),[x,f]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),[N,y]=(0,r.useState)(null),[w,q]=(0,r.useState)(!1),[S,C]=(0,r.useState)([]),[M,R]=(0,r.useState)([]),[_,F]=(0,r.useState)(""),L=(0,r.useRef)(null),[O,W]=(0,r.useState)({}),[A,P]=(0,r.useState)(!1),[U,B]=(0,r.useState)([]),[D,H]=(0,r.useState)(!1),[V,K]=(0,r.useState)(null),Y=(0,r.useMemo)(()=>{if(null===N||void 0===N||!N.sections)return[];const e=[];e.push({key:"rollNumber",label:"Career Nine Roll Number",sectionName:"Student Identity",isMQT:!1,type:"identity"});for(const r of N.sections)for(const o of r.questions){var s;if(o.isMQT)for(const s of o.options){var t,n;e.push({key:"mqt_".concat(o.questionnaireQuestionId,"_").concat(s.optionId),label:"".concat((null===(t=o.questionText)||void 0===t?void 0:t.substring(0,50))||"Q"+o.questionnaireQuestionId," \u2192 ").concat(null===(n=s.optionText)||void 0===n?void 0:n.substring(0,40)),sectionName:r.sectionName,isMQT:!0,type:"mqt_option"})}else e.push({key:"q_".concat(o.questionnaireQuestionId),label:(null===(s=o.questionText)||void 0===s?void 0:s.substring(0,80))||"Question ".concat(o.questionnaireQuestionId),sectionName:r.sectionName,isMQT:!1,type:"question"})}return e},[N]),J=(0,r.useMemo)(()=>{if(!A||!N)return[];const e=new Set;for(const[t]of Object.entries(O))if(t.startsWith("q_"))e.add(Number(t.substring(2)));else if(t.startsWith("mqt_")){const s=Number(t.split("_")[1]);e.add(s)}const s=[];for(const t of N.sections)for(const n of t.questions)e.has(n.questionnaireQuestionId)&&s.push({qqId:n.questionnaireQuestionId,questionText:n.questionText,isMQT:n.isMQT,options:n.options,sectionName:t.sectionName});return s},[A,O,N]),X=(0,r.useMemo)(()=>{const e=[],s=!!O.rollNumber;s||e.push("Map a column to 'Roll Number' (required)");const t=new Set;for(const r of Object.keys(O))r.startsWith("q_")?t.add(Number(r.substring(2))):r.startsWith("mqt_")&&t.add(Number(r.split("_")[1]));const n=(null===N||void 0===N?void 0:N.questions.length)||0;return 0===t.size?e.push("No question columns mapped"):t.size<n&&e.push("".concat(t.size," of ").concat(n," questions mapped")),{issues:e,hasRollNumber:s,mappedCount:t.size}},[O,N]);(0,r.useEffect)(()=>{$()},[]);const $=async()=>{f(!0);try{const e=await(0,k.hi)();c(e.data||[])}catch(e){console.error("Failed to load institutes:",e)}finally{f(!1)}};(0,r.useEffect)(()=>{d?G(Number(d)):(h([]),b(""),y(null),se())},[d]);const G=async e=>{j(!0),b(""),y(null),se();try{let t=[],n=[];try{t=(await(0,Q.Kk)(e)).data||[]}catch(s){console.error("Failed to load institute mappings:",s)}try{n=(await(0,Q.bR)()).data||[]}catch(s){console.error("Failed to load assessment list:",s)}if(t.length>0){const e=new Set(t.map(e=>e.assessmentId)),s=n.filter(s=>e.has(s.id));h(s)}else h(n)}catch(t){console.error("Failed to load assessments:",t)}finally{j(!1)}};(0,r.useEffect)(()=>{p?ee(Number(p)):(y(null),se())},[p]);const ee=async e=>{q(!0),se();try{const s=await function(e){return z().get("".concat(T,"/assessment-answer/offline-mapping/").concat(e))}(e);y(s.data)}catch(s){console.error("Failed to load mapping:",s),alert("Failed to load assessment mapping. Make sure the assessment has a linked questionnaire.")}finally{q(!1)}},se=()=>{C([]),R([]),W({}),P(!1),B([]),F(""),K(null),L.current&&(L.current.value="")},te=(0,r.useMemo)(()=>new Set(Object.values(O)),[O]),ne=(0,r.useMemo)(()=>{const e={};for(const s of Y)e[s.sectionName]||(e[s.sectionName]=[]),e[s.sectionName].push(s);return e},[Y]);return(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)("div",{className:"card-header",children:(0,v.jsx)("h3",{className:"card-title",children:"Offline Assessment Data Upload"})}),(0,v.jsxs)("div",{className:"card-body",children:[(0,v.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,v.jsx)("h6",{className:"mb-3",children:"Select School & Assessment"}),(0,v.jsxs)("div",{className:"row g-3 align-items-end",children:[(0,v.jsxs)("div",{className:"col-md-5",children:[(0,v.jsx)(o.Z.Label,{children:"School / Institute"}),x?(0,v.jsxs)("div",{children:[(0,v.jsx)(i.Z,{animation:"border",size:"sm"})," Loading..."]}):(0,v.jsxs)(o.Z.Select,{value:d,onChange:e=>u(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Select an institute..."}),t.map(e=>(0,v.jsx)("option",{value:e.instituteCode,children:e.instituteName},e.instituteCode))]})]}),(0,v.jsxs)("div",{className:"col-md-5",children:[(0,v.jsx)(o.Z.Label,{children:"Assessment"}),g?(0,v.jsxs)("div",{children:[(0,v.jsx)(i.Z,{animation:"border",size:"sm"})," Loading..."]}):(0,v.jsxs)(o.Z.Select,{value:p,onChange:e=>b(e.target.value),disabled:!d,children:[(0,v.jsx)("option",{value:"",children:"Select an assessment..."}),m.map(e=>(0,v.jsx)("option",{value:e.id,children:e.assessmentName},e.id))]})]}),(0,v.jsx)("div",{className:"col-md-2",children:w&&(0,v.jsx)(i.Z,{animation:"border",size:"sm",className:"ms-2"})})]}),N&&(0,v.jsxs)("div",{className:"mt-3",children:[(0,v.jsxs)(a.Z,{bg:"success",className:"me-2",children:["Questionnaire: ",N.questionnaireName]}),(0,v.jsxs)(a.Z,{bg:"info",className:"me-2",children:[(null===(e=N.sections)||void 0===e?void 0:e.length)||0," sections"]}),(0,v.jsxs)(a.Z,{bg:"secondary",children:[N.questions.length," questions"]})]})]}),N&&(0,v.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,v.jsx)("h6",{className:"mb-3",children:"Upload Excel File"}),(0,v.jsxs)("div",{className:"row g-3 align-items-end",children:[(0,v.jsxs)("div",{className:"col-md-6",children:[(0,v.jsx)(o.Z.Label,{children:"Choose Excel File"}),(0,v.jsx)(o.Z.Control,{type:"file",accept:".xlsx,.xls",ref:L,onChange:e=>{var s;const t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!t||!N)return;F(t.name),K(null),P(!1),B([]);const n=new FileReader;n.onload=e=>{var s;const t=null===(s=e.target)||void 0===s?void 0:s.result,n=Z.read(t,{type:"binary",cellDates:!0}),r=n.SheetNames[0],o=n.Sheets[r],i=Z.utils.sheet_to_json(o,{defval:"",raw:!1});if(0===i.length)return void alert("The Excel file is empty or has no data rows.");const a=Object.keys(i[0]);C(a),R(i);const l={};for(const c of a){const e=c.toLowerCase().trim();"roll number"!==e&&"rollnumber"!==e&&"roll_number"!==e&&"career nine roll number"!==e&&"careerninerollnumber"!==e||(l.rollNumber=c)}W(l)},n.readAsBinaryString(t)}})]}),(0,v.jsx)("div",{className:"col-md-4",children:_&&(0,v.jsx)("small",{className:"text-muted",children:_})}),(0,v.jsx)("div",{className:"col-md-2",children:S.length>0&&(0,v.jsxs)(a.Z,{bg:"info",children:[M.length," rows, ",S.length," columns"]})})]}),(0,v.jsx)("div",{className:"mt-2",children:(0,v.jsxs)("small",{className:"text-muted",children:["Upload any Excel file with one student per row. Students are matched by their ",(0,v.jsx)("strong",{children:"Career Nine Roll Number"}),". You will map columns to questions next."]})})]}),S.length>0&&N&&!A&&(0,v.jsxs)("div",{className:"card card-body bg-light mb-4",children:[(0,v.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,v.jsx)("h6",{className:"mb-0",children:"Map DB Questions to Excel Columns"}),(0,v.jsxs)("div",{className:"d-flex gap-2 align-items-center",children:[X.issues.length>0&&(0,v.jsx)("small",{className:"text-warning",children:X.issues[0]}),(0,v.jsx)(l.Z,{variant:"primary",size:"sm",onClick:()=>{if(!N||0===M.length)return;const e=O.rollNumber,s=M.map(s=>{var t;const n=[],r=e?String(null!==(t=s[e])&&void 0!==t?t:"").trim():"";r||n.push("Roll number is required");const o={},i={};for(const[e,a]of Object.entries(O)){if("rollNumber"===e)continue;const t=s[a];if(e.startsWith("q_")){const s=Number(e.substring(2)),r=N.questions.find(e=>e.questionnaireQuestionId===s);if(r){const e=E(t,r.options);o[s]=e.optionId,e.error&&n.push("".concat(a,": ").concat(e.error))}}else if(e.startsWith("mqt_")){const s=e.split("_"),n=Number(s[1]),r=Number(s[2]),o=String(null!==t&&void 0!==t?t:"").trim();"1"!==o&&"yes"!==o.toLowerCase()&&"y"!==o.toLowerCase()||(i[n]||(i[n]=[]),i[n].push(r))}}for(const[e,a]of Object.entries(i)){const s=Number(e);1===a.length?o[s]=a[0]:a.length>1&&(o[s]=null,n.push("Question ".concat(s,": Multiple MQT options selected")))}return{rollNumber:r,answers:o,rowErrors:n}});B(s),P(!0)},disabled:!X.hasRollNumber||0===X.mappedCount,children:"Apply Mapping & Preview"})]})]}),(0,v.jsx)("div",{style:{maxHeight:"500px",overflowY:"auto",border:"1px solid #dee2e6"},children:(0,v.jsxs)("table",{className:"table table-bordered table-sm mb-0",children:[(0,v.jsx)("thead",{style:{position:"sticky",top:0,zIndex:2,backgroundColor:"#212529",color:"#fff"},children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{style:{width:"50%",backgroundColor:"#212529",color:"#fff"},children:"DB Question / Field"}),(0,v.jsx)("th",{style:{width:"50%",backgroundColor:"#212529",color:"#fff"},children:"Excel Column"})]})}),(0,v.jsx)("tbody",{children:Object.entries(ne).map(e=>{let[s,t]=e;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("tr",{className:"table-secondary",children:(0,v.jsxs)("td",{colSpan:2,children:[(0,v.jsx)("strong",{children:s}),(0,v.jsxs)("small",{className:"text-muted ms-2",children:["(",t.length," fields)"]})]})},"section-".concat(s)),t.map(e=>{const s=O[e.key]||"",t=!!s;return(0,v.jsxs)("tr",{className:t?"":"text-muted",children:[(0,v.jsxs)("td",{children:[e.label,e.isMQT&&(0,v.jsx)(a.Z,{bg:"info",className:"ms-1",style:{fontSize:"0.65rem"},children:"MQT"}),"rollNumber"===e.key&&(0,v.jsx)(a.Z,{bg:"danger",className:"ms-1",style:{fontSize:"0.65rem"},children:"Required"})]}),(0,v.jsx)("td",{children:(0,v.jsxs)(o.Z.Select,{size:"sm",value:s,onChange:s=>{return t=e.key,r=s.target.value,void W(e=>{const s=(0,n.Z)({},e);return""===r?delete s[t]:s[t]=r,s});var t,r},children:[(0,v.jsx)("option",{value:"",children:"-- Not mapped --"}),S.map(e=>(0,v.jsxs)("option",{value:e,disabled:te.has(e)&&e!==s,children:[e,te.has(e)&&e!==s?" (already used)":""]},e))]})})]},e.key)})]})})})]})})]}),A&&U.length>0&&N&&(0,v.jsxs)("div",{className:"mb-4",children:[(0,v.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,v.jsxs)("h6",{className:"mb-0",children:["Preview (",U.length," students)",U.some(e=>e.rowErrors.length>0)&&(0,v.jsx)(a.Z,{bg:"warning",className:"ms-2",children:"Has warnings"})]}),(0,v.jsxs)("div",{className:"d-flex gap-2",children:[(0,v.jsx)(l.Z,{variant:"outline-secondary",size:"sm",onClick:()=>{P(!1),B([])},children:"Back to Mapping"}),(0,v.jsx)(l.Z,{variant:"outline-secondary",size:"sm",onClick:se,children:"Clear & Re-upload"})]})]}),(0,v.jsx)("div",{style:{maxHeight:"500px",overflow:"auto",border:"1px solid #dee2e6"},children:(0,v.jsxs)("table",{className:"table table-bordered table-sm table-hover mb-0",children:[(0,v.jsx)("thead",{style:{position:"sticky",top:0,zIndex:2,backgroundColor:"#212529",color:"#fff"},children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{style:{minWidth:"40px",backgroundColor:"#212529",color:"#fff"},children:"#"}),(0,v.jsx)("th",{style:{minWidth:"150px",backgroundColor:"#212529",color:"#fff"},children:"Roll Number"}),J.map(e=>{var s;return(0,v.jsxs)("th",{style:{minWidth:"140px",backgroundColor:"#212529",color:"#fff"},title:e.questionText,children:[(null===(s=e.questionText)||void 0===s?void 0:s.substring(0,25))||"Q".concat(e.qqId),e.isMQT&&(0,v.jsx)(a.Z,{bg:"info",className:"ms-1",style:{fontSize:"0.6rem"},children:"MQT"})]},e.qqId)})]})}),(0,v.jsx)("tbody",{children:U.map((e,s)=>{const t=e.rowErrors.length>0,r=!e.rollNumber.trim();return(0,v.jsxs)("tr",{className:r||t?"table-danger":"",title:e.rowErrors.length>0?e.rowErrors.join("; "):"",children:[(0,v.jsx)("td",{children:s+1}),(0,v.jsx)("td",{children:(0,v.jsx)("input",{type:"text",className:"form-control form-control-sm ".concat(r?"is-invalid":""),value:e.rollNumber,onChange:e=>{return t=s,r=e.target.value,void B(e=>{const s=[...e];return s[t]=(0,n.Z)((0,n.Z)({},s[t]),{},{rollNumber:r}),s});var t,r},style:{minWidth:"130px"}})}),J.map(t=>{const r=e.answers[t.qqId],o=e.rowErrors.some(e=>e.includes("".concat(t.qqId)));return(0,v.jsx)("td",{className:o?"table-danger":"",children:(0,v.jsxs)("select",{className:"form-select form-select-sm",value:null!==r&&void 0!==r?r:"",onChange:e=>((e,s,t)=>{B(r=>{const o=[...r],i=(0,n.Z)({},o[e]);return i.answers=(0,n.Z)((0,n.Z)({},i.answers),{},{[s]:t}),o[e]=i,o})})(s,t.qqId,""===e.target.value?null:Number(e.target.value)),children:[(0,v.jsx)("option",{value:"",children:"-- Skip --"}),t.options.map(e=>(0,v.jsx)("option",{value:e.optionId,children:e.optionText},e.optionId))]})},t.qqId)})]},s)})})]})})]}),A&&U.length>0&&N&&(0,v.jsx)("div",{className:"card card-body bg-light",children:(0,v.jsxs)("div",{className:"d-flex align-items-center gap-3 flex-wrap",children:[(0,v.jsx)(l.Z,{variant:"success",size:"lg",onClick:async()=>{if(!N||0===U.length)return;const e=U.filter(e=>!e.rollNumber.trim());if(e.length>0)return void alert("".concat(e.length," row(s) have no roll number. Please fix before submitting."));const s=U.filter(e=>e.rowErrors.length>0);if(!(s.length>0)||window.confirm("".concat(s.length," row(s) have parsing warnings. Those answers may be skipped. Continue?"))){H(!0),K(null);try{const e=U.map(e=>({rollNumber:e.rollNumber.trim(),answers:Object.entries(e.answers).filter(e=>{let[,s]=e;return null!==s}).map(e=>{let[s,t]=e;return{questionnaireQuestionId:Number(s),optionId:t}})})),s=await(n={assessmentId:N.assessmentId,instituteId:Number(d),students:e},z().post("".concat(T,"/assessment-answer/bulk-submit-by-rollnumber"),n));K(s.data)}catch(r){var t;console.error("Submit failed:",r),K({status:"error",message:(null===(t=r.response)||void 0===t?void 0:t.data)||r.message})}finally{H(!1)}var n}},disabled:D,children:D?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(i.Z,{animation:"border",size:"sm",className:"me-2"}),"Submitting..."]}):(0,v.jsxs)(v.Fragment,{children:["Submit All (",U.length," students)"]})}),V&&"success"===V.status&&(0,v.jsxs)(I,{variant:"success",className:"mb-0 flex-grow-1",children:[(0,v.jsx)("strong",{children:"Upload complete."}),(0,v.jsxs)("div",{children:["Students processed: ",(0,v.jsx)("strong",{children:V.studentsProcessed})]}),V.matchSummary&&(0,v.jsxs)("div",{children:["Matched by roll number: ",(0,v.jsx)(a.Z,{bg:"primary",children:V.matchSummary.matched})," ","Failed: ",(0,v.jsx)(a.Z,{bg:V.matchSummary.failed>0?"danger":"secondary",children:V.matchSummary.failed})]}),(null===(s=V.errors)||void 0===s?void 0:s.length)>0&&(0,v.jsxs)("div",{className:"mt-2",children:[(0,v.jsx)("strong",{children:"Errors:"}),V.errors.map((e,s)=>{var t;return(0,v.jsxs)("div",{className:"text-danger",children:["Row ",(null!==(t=e.rowIndex)&&void 0!==t?t:0)+1," (Roll: ",e.rollNumber,"): ",e.error]},s)})]})]}),V&&"error"===V.status&&(0,v.jsxs)(I,{variant:"danger",className:"mb-0 flex-grow-1",children:["Submission failed: ","string"===typeof V.message?V.message:JSON.stringify(V.message)]})]})})]})]})}}}]);
//# sourceMappingURL=958.8884b473.chunk.js.map