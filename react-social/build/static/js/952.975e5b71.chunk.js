"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[952],{46952:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var o=t(1413),n=t(45987),i=t(49142),a=t(28182),l=t(72791),r=t(8284),c=t(16871),d=t(81724),m=t(34042),u=t(93189),p=t(91591),h=t(94970),x=t(80184);d.Ry().shape({questionText:d.Z_().required("Question text is required"),questionType:d.Z_().required("Question type is required"),sectionId:d.Z_().required("Section is required"),maxOptionsAllowed:d.Rx()});const f=e=>{let{setPageLoading:s}=e;const[t,d]=(0,l.useState)(!1),[f,b]=(0,l.useState)([]),[g,y]=(0,l.useState)([]),[v,j]=(0,l.useState)({}),[N,q]=l.useState(!1),Z=(0,c.s0)(),[w,T]=(0,l.useState)({}),[k,O]=(0,l.useState)({}),[S,I]=(0,l.useState)(!1),[C,Q]=(0,l.useState)([]),[E,A]=(0,l.useState)(""),D={questionText:"",questionType:"",maxOptionsAllowed:"",questionOptions:[""],sectionId:""},M=()=>{F(e=>{const s=[...e.questionOptions,""];return(0,o.Z)((0,o.Z)({},e),{},{questionOptions:s})})},G=(e,s)=>{if(s){const t=new FileReader;t.onloadend=()=>{O(s=>(0,o.Z)((0,o.Z)({},s),{},{[e]:t.result}))},t.readAsDataURL(s)}else O(s=>{const t=(0,o.Z)({},s);return delete t[e],t})},[R,F]=(0,l.useState)(D);return(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,m.Bx)();b(e.data)}catch(e){b([])}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,u.rS)();y(e.data)}catch(e){y([])}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{const e=await(0,h.WL)();Q(e.data)}catch(e){Q([])}})()},[]),(0,l.useEffect)(()=>{S?(F(e=>(0,o.Z)((0,o.Z)({},e),{},{questionOptions:[]})),j({}),q(!1)):A("")},[S]),(0,l.useEffect)(()=>{N||S||(F(e=>(0,o.Z)((0,o.Z)({},e),{},{questionOptions:[""]})),j({}))},[N]),(0,x.jsx)("div",{className:"container py-5",children:(0,x.jsxs)("div",{className:"card shadow-sm py-5",children:[(0,x.jsx)("div",{className:"card-header",children:(0,x.jsx)("h1",{className:"mb-0",children:"Add Assessment Question"})}),(0,x.jsxs)("form",{className:"form w-100 fv-plugins-bootstrap5 fv-plugins-framework",onSubmit:async e=>{e.preventDefault(),d(!0);try{console.log("Submitting form. optionMeasuredQualities state:",v);let e=[];e=S&&E?[{optionText:null,optionImageBase64:null,optionScores:[],correct:!1,isGame:!0,game:{gameId:Number(E)}}]:R.questionOptions.map((e,s)=>{const t="image"===w[s],o=t?null:"string"===typeof e?e:e.optionText,n=t&&k[s]||null,i="string"!==typeof e&&(e.correct||!1),a="string"===typeof e?null:e.optionDescription||null,l=[];return v[s]&&Object.entries(v[s]).forEach(e=>{let[s,t]=e;t.checked&&l.push({score:t.score,question_option:{},measuredQualityType:{measuredQualityTypeId:Number(s)}})}),{optionText:o,optionImageBase64:n,optionScores:l,correct:i,isGame:!1,game:null,optionDescription:a}});const s={questionText:R.questionText,questionType:R.questionType,maxOptionsAllowed:Number(R.maxOptionsAllowed)||0,options:e,section:{sectionId:Number(R.sectionId)},flag:N?1:0};console.log("Payload to submit:",s),await(0,u.Nj)(s),F(D),j({}),T({}),O({}),A(""),I(!1),Z("/assessment-questions")}catch(s){console.error("Error creating question:",s)}finally{d(!1)}},children:[(0,x.jsxs)("div",{className:"card-body",children:[(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Text:"}),(0,x.jsx)("textarea",{name:"questionText",placeholder:"Enter Question Text",rows:4,className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!R.questionText,"is-valid":!!R.questionText}),value:R.questionText,onChange:e=>F(s=>(0,o.Z)((0,o.Z)({},s),{},{questionText:e.target.value}))})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Type:"}),(0,x.jsxs)("select",{name:"questionType",className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!R.questionType,"is-valid":!!R.questionType}),value:R.questionType,onChange:e=>F(s=>(0,o.Z)((0,o.Z)({},s),{},{questionType:e.target.value})),children:[(0,x.jsx)("option",{value:"",children:"Select Question Type"}),(0,x.jsx)("option",{value:"multiple-choice",children:"Multiple Choice"}),(0,x.jsx)("option",{value:"single-choice",children:"Single Choice"}),(0,x.jsx)("option",{value:"ranking",children:"Ranking"})]})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Section"}),(0,x.jsxs)("select",{name:"sectionId",className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!R.sectionId,"is-valid":!!R.sectionId}),value:R.sectionId,onChange:e=>F(s=>(0,o.Z)((0,o.Z)({},s),{},{sectionId:e.target.value})),children:[(0,x.jsx)("option",{value:"",children:"Select Section"}),f.map(e=>(0,x.jsx)("option",{value:e.sectionId,children:e.sectionName},e.sectionId))]})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Options:"}),S?(0,x.jsxs)("div",{className:"p-3 border rounded bg-light",children:[(0,x.jsx)("div",{className:"d-flex align-items-center mb-2",children:(0,x.jsx)("span",{className:"me-2 fw-bold",children:"\ud83c\udfae Select Game:"})}),(0,x.jsxs)("select",{className:(0,a.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!E,"is-valid":!!E}),value:E,onChange:e=>A(e.target.value),children:[(0,x.jsx)("option",{value:"",children:"Select a Game"}),C.map(e=>(0,x.jsxs)("option",{value:e.gameId,children:[e.gameName," (Code: ",e.gameCode,")"]},e.gameId))]}),E&&(0,x.jsx)("div",{className:"mt-2 text-success",children:"\u2705 Game selected. This question will launch the selected game as an option."})]}):N?(0,x.jsx)(p.O,{mqt:g,formikValues:R,setFormikValues:F}):R.questionOptions.map((e,s)=>{const t="string"===typeof e?e:e.optionText,l="image"===w[s];return(0,x.jsxs)("div",{className:"mb-3 p-3 border rounded bg-light",children:[(0,x.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,x.jsxs)("span",{className:"me-2 fw-bold",children:["Option ",s+1,":"]}),(0,x.jsxs)("div",{className:"form-check form-switch ms-auto",children:[(0,x.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"option-type-switch-".concat(s),checked:l,onChange:()=>(e=>{T(s=>(0,o.Z)((0,o.Z)({},s),{},{[e]:"image"===s[e]?"text":"image"}))})(s)}),(0,x.jsx)("label",{className:"form-check-label",htmlFor:"option-type-switch-".concat(s),children:l?"\ud83d\udcf7 Image":"\ud83d\udcdd Text"})]})]}),(0,x.jsxs)("div",{className:"d-flex align-items-start gap-2",children:[l?(0,x.jsxs)("div",{className:"flex-grow-1",children:[(0,x.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return G(s,(null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"form-control form-control-sm mb-2"}),k[s]&&(0,x.jsxs)("div",{className:"position-relative d-inline-block",children:[(0,x.jsx)("img",{src:k[s],alt:"Option ".concat(s+1),style:{maxWidth:150,maxHeight:100,objectFit:"cover",borderRadius:4,border:"1px solid #ddd"}}),(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 8px",fontSize:12},onClick:()=>G(s,null),children:"\xd7"})]})]}):(0,x.jsx)("input",{type:"text",placeholder:"Enter option ".concat(s+1),value:t,onChange:e=>((e,s)=>{F(t=>{const n=[...t.questionOptions];return"string"===typeof n[e]?n[e]=s:n[e]=(0,o.Z)((0,o.Z)({},n[e]),{},{optionText:s}),(0,o.Z)((0,o.Z)({},t),{},{questionOptions:n})})})(s,e.target.value),className:(0,a.default)("form-control form-control-lg form-control-solid flex-grow-1",{"is-invalid text-danger":!t,"is-valid":!!t})}),(0,x.jsxs)(r.Z,{children:[(0,x.jsx)(r.Z.Toggle,{variant:"secondary",id:"dropdown-option-".concat(s),size:"sm",children:"MQT"}),(0,x.jsxs)(r.Z.Menu,{style:{minWidth:250},children:[(0,x.jsx)(r.Z.Header,{children:"Measured Quality Types"}),(0,x.jsx)("div",{style:{maxHeight:250,overflowY:"auto",padding:8},children:g.map((e,t)=>{var a,l,r,c,d,m;return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,x.jsx)("input",{type:"checkbox",checked:!(null===(a=v[s])||void 0===a||null===(l=a[e.measuredQualityTypeId])||void 0===l||!l.checked),onChange:()=>{return t=s,a=e.measuredQualityTypeId,void j(e=>{const s=e[t]||{},l=s[a];if(l&&l.checked){const{[a]:l}=s,r=(0,n.Z)(s,[a].map(i.Z));return(0,o.Z)((0,o.Z)({},e),{},{[t]:r})}return(0,o.Z)((0,o.Z)({},e),{},{[t]:(0,o.Z)((0,o.Z)({},s),{},{[a]:{checked:!0,score:0}})})});var t,a},className:"form-check-input me-2",id:"option-".concat(s,"-type-").concat(e.measuredQualityTypeId)}),(0,x.jsx)("label",{htmlFor:"option-".concat(s,"-type-").concat(e.measuredQualityTypeId),className:"me-2 mb-0",children:e.measuredQualityTypeName}),!(null===(r=v[s])||void 0===r||null===(c=r[e.measuredQualityTypeId])||void 0===c||!c.checked)&&(0,x.jsx)("input",{type:"number",min:0,max:100,value:null!==(d=null===(m=v[s][e.measuredQualityTypeId])||void 0===m?void 0:m.score)&&void 0!==d?d:0,onChange:t=>{return n=s,i=e.measuredQualityTypeId,a=Number(t.target.value),void j(e=>(0,o.Z)((0,o.Z)({},e),{},{[n]:(0,o.Z)((0,o.Z)({},e[n]),{},{[i]:{checked:!0,score:a}})}));var n,i,a},placeholder:"Score",className:"form-control form-control-sm ms-2",style:{width:70}})]}),t<g.length-1&&(0,x.jsx)("hr",{style:{margin:"4px 0"}})]},e.measuredQualityTypeId)})})]})]}),R.questionOptions.length>1&&(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>(e=>{F(s=>{const t=s.questionOptions.filter((s,t)=>t!==e);return j(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),T(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),O(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),(0,o.Z)((0,o.Z)({},s),{},{questionOptions:t})})})(s),children:"-"}),s===R.questionOptions.length-1&&(0,x.jsx)("button",{type:"button",className:"btn btn-sm btn-primary",onClick:M,children:"+"})]}),(0,x.jsxs)("div",{className:"mt-2",children:[(0,x.jsx)("label",{className:"fs-7 fw-semibold mb-1 text-muted",children:"Option Description:"}),(0,x.jsx)("textarea",{className:"form-control form-control-sm",rows:2,placeholder:"Enter description for this option (optional)",value:("string"===typeof e?"":e.optionDescription)||"",onChange:e=>((e,s)=>{F(t=>{const n=[...t.questionOptions],i=n[e];return n[e]="string"===typeof i?{optionText:i,optionDescription:s}:(0,o.Z)((0,o.Z)({},i),{},{optionDescription:s}),(0,o.Z)((0,o.Z)({},t),{},{questionOptions:n})})})(s,e.target.value)})]})]},s)})]}),(0,x.jsxs)("div",{className:"fv-row mb-7",children:[(0,x.jsx)("label",{className:"fs-6 fw-bold mb-2",children:"Max Options Allowed"}),(0,x.jsx)("input",{type:"number",min:0,max:100,value:R.maxOptionsAllowed,onChange:e=>F(s=>(0,o.Z)((0,o.Z)({},s),{},{maxOptionsAllowed:e.target.value})),placeholder:"Max Options Allowed",className:"form-control form-control-lg form-control-solid w-25",style:{width:200}})]}),(0,x.jsxs)("div",{className:"mb-4 d-flex gap-4",children:[(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:N,onChange:()=>{q(e=>!e),N||I(!1)},className:"me-2",disabled:S}),"Use Measured Quality Types as Options"]}),(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:S,onChange:()=>{I(e=>!e),S||q(!1)},className:"me-2",disabled:N}),"\ud83c\udfae Use Game as Option"]})]})]}),(0,x.jsxs)("div",{className:"card-footer d-flex justify-content-end",children:[(0,x.jsx)("button",{type:"button",className:"btn btn-light me-2",onClick:()=>Z("/assessment-questions"),children:"Cancel"}),(0,x.jsxs)("button",{type:"submit",className:"btn btn-primary",disabled:t,children:[!t&&(0,x.jsx)("span",{className:"indicator-label",children:"Submit"}),t&&(0,x.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait..."," ",(0,x.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})]})})}}}]);
//# sourceMappingURL=952.975e5b71.chunk.js.map