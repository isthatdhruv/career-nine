"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[15],{98015:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var n=t(1413),a=t(72791),l=t(74569),c=t.n(l);const d="https://api.career-9.com";var r=t(26975),o=t(80184);const i=()=>{const[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(null),[i,p]=(0,a.useState)([]),[m,h]=(0,a.useState)(!1),[u,x]=(0,a.useState)({}),[g,b]=(0,a.useState)(new Set),[j,v]=(0,a.useState)(new Set),[f,N]=(0,a.useState)(!1),[w,I]=(0,a.useState)(!1),[y,A]=(0,a.useState)(null);(0,a.useEffect)(()=>{c().get("".concat(d,"/assessments/get/list")).then(e=>{s(e.data||[])}).catch(e=>console.error("Failed to load assessments:",e))},[]),(0,a.useEffect)(()=>{var e;t?(h(!0),(e=t,c().get("".concat(d,"/assessment-answer/text-responses/").concat(e))).then(e=>{const s=e.data||[];p(s);const t={};for(const a of s){var n;t[a.assessmentAnswerId]=(null===(n=a.mappedOption)||void 0===n?void 0:n.optionId)||""}x(t)}).catch(e=>{console.error("Failed to load text responses:",e),A({type:"danger",text:"Failed to load text responses."})}).finally(()=>h(!1))):p([])},[t]);const S=async e=>{const s=u[e];if(s){b(s=>new Set(s).add(e));try{await function(e,s){return c().put("".concat(d,"/assessment-answer/map-text-response"),{assessmentAnswerId:e,optionId:s})}(e,s),p(t=>t.map(t=>{if(t.assessmentAnswerId===e){var a;const e=null===(a=t.question)||void 0===a?void 0:a.options.find(e=>e.optionId===s);return(0,n.Z)((0,n.Z)({},t),{},{mappedOption:e||null})}return t})),A({type:"success",text:"Mapping saved successfully."})}catch(t){console.error("Failed to map:",t),A({type:"danger",text:"Failed to save mapping."})}finally{b(s=>{const t=new Set(s);return t.delete(e),t})}}},O=i.filter(e=>!e.mappedOption&&!u[e.assessmentAnswerId]).length,k=i.length;return(0,o.jsxs)("div",{className:"card",children:[(0,o.jsx)("div",{className:"card-header border-0 pt-6",children:(0,o.jsx)("div",{className:"card-title",children:(0,o.jsx)("h3",{className:"fw-bolder m-0",children:"Text Response Mapping"})})}),(0,o.jsxs)("div",{className:"card-body py-4",children:[y&&(0,o.jsxs)("div",{className:"alert alert-".concat(y.type," alert-dismissible fade show"),role:"alert",children:[y.text,(0,o.jsx)("button",{type:"button",className:"btn-close",onClick:()=>A(null)})]}),(0,o.jsxs)("div",{className:"row mb-5",children:[(0,o.jsxs)("div",{className:"col-md-4",children:[(0,o.jsx)("label",{className:"fs-6 fw-bold mb-2",children:"Select Assessment"}),(0,o.jsxs)("select",{className:"form-select form-select-solid",value:t||"",onChange:e=>l(e.target.value?Number(e.target.value):null),children:[(0,o.jsx)("option",{value:"",children:"-- Select Assessment --"}),e.map(e=>(0,o.jsx)("option",{value:e.id,children:e.assessmentName},e.id))]})]}),t&&i.length>0&&(0,o.jsxs)("div",{className:"col-md-8 d-flex align-items-end gap-3",children:[(0,o.jsx)("button",{className:"btn btn-info",onClick:async()=>{const e=i.filter(e=>{var s,t;return!u[e.assessmentAnswerId]&&(null===(s=e.question)||void 0===s||null===(t=s.options)||void 0===t?void 0:t.length)});if(0!==e.length){N(!0);try{const s=e.map(e=>({textResponse:e.textResponse,options:e.question.options})),t=await(0,r.Iz)(s);if(t.results){const s=(0,n.Z)({},u);for(let n=0;n<e.length;n++){const a=t.results[n];a.matchedOptionId&&(s[e[n].assessmentAnswerId]=a.matchedOptionId)}x(s);const a=t.results.filter(e=>e.matchedOptionId).length;A({type:"success",text:"AI mapped ".concat(a," of ").concat(e.length," responses. Review and save each mapping.")})}}catch(s){console.error("Bulk AI matching failed:",s),A({type:"danger",text:"Bulk AI matching failed."})}finally{N(!1)}}else A({type:"danger",text:"No unmapped responses to process."})},disabled:f||0===O,children:f?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"AI Processing..."]}):(0,o.jsxs)(o.Fragment,{children:["AI Auto-Map Unmapped (",O,")"]})}),(0,o.jsx)("button",{className:"btn btn-success",onClick:async()=>{if(t){I(!0);try{const s=(await(e=t,c().post("".concat(d,"/assessment-answer/recalculate-scores/").concat(e)))).data;A({type:"success",text:"Scores recalculated for ".concat(s.studentsProcessed," students.")})}catch(s){console.error("Recalculation failed:",s),A({type:"danger",text:"Score recalculation failed."})}finally{I(!1)}var e}},disabled:w,children:w?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Recalculating..."]}):"Recalculate Scores"}),(0,o.jsxs)("span",{className:"badge bg-secondary fs-7 p-3",children:[k," responses, ",O," unmapped"]})]})]}),m?(0,o.jsxs)("div",{className:"text-center py-10",children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-lg"}),(0,o.jsx)("p",{className:"mt-3",children:"Loading text responses..."})]}):t?0===i.length?(0,o.jsx)("div",{className:"text-center py-10 text-muted",children:(0,o.jsx)("p",{className:"fs-5",children:"No text responses found for this assessment."})}):(0,o.jsx)("div",{className:"table-responsive",children:(0,o.jsxs)("table",{className:"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{className:"fw-bolder text-muted",children:[(0,o.jsx)("th",{className:"min-w-200px",children:"Question"}),(0,o.jsx)("th",{className:"min-w-150px",children:"Text Response"}),(0,o.jsx)("th",{className:"min-w-50px",children:"Count"}),(0,o.jsx)("th",{className:"min-w-200px",children:"Map to Option"}),(0,o.jsx)("th",{className:"min-w-50px",children:"Status"}),(0,o.jsx)("th",{className:"min-w-150px text-end",children:"Actions"})]})}),(0,o.jsx)("tbody",{children:i.map(e=>{var s,t,a,l,c;const d=u[e.assessmentAnswerId],i=(null===(s=e.mappedOption)||void 0===s?void 0:s.optionId)===d,p=g.has(e.assessmentAnswerId),m=j.has(e.assessmentAnswerId);return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("span",{className:"text-dark d-block fs-7",style:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(null===(t=e.question)||void 0===t?void 0:t.questionText)||"N/A"})}),(0,o.jsx)("td",{children:(0,o.jsx)("span",{className:"badge bg-light-primary text-primary fs-7 p-2",children:e.textResponse})}),(0,o.jsx)("td",{children:(0,o.jsx)("span",{className:"badge bg-secondary fs-7",children:e.count||1})}),(0,o.jsx)("td",{children:(0,o.jsxs)("select",{className:"form-select form-select-sm",value:d||"",onChange:s=>x(t=>(0,n.Z)((0,n.Z)({},t),{},{[e.assessmentAnswerId]:s.target.value?Number(s.target.value):""})),children:[(0,o.jsx)("option",{value:"",children:"-- Select Option --"}),null===(a=e.question)||void 0===a?void 0:a.options.map(e=>(0,o.jsx)("option",{value:e.optionId,children:e.optionText},e.optionId))]})}),(0,o.jsx)("td",{children:e.mappedOption?(0,o.jsx)("span",{className:"badge bg-success",children:"Mapped"}):d?(0,o.jsx)("span",{className:"badge bg-warning text-dark",children:"Unsaved"}):(0,o.jsx)("span",{className:"badge bg-danger",children:"Unmapped"})}),(0,o.jsxs)("td",{className:"text-end",children:[(0,o.jsx)("button",{className:"btn btn-sm btn-light-info me-2",onClick:()=>(async e=>{var s,t;if(null!==(s=e.question)&&void 0!==s&&null!==(t=s.options)&&void 0!==t&&t.length){v(s=>new Set(s).add(e.assessmentAnswerId));try{const s=await(0,r.Q5)(e.textResponse,e.question.options);s.matchedOptionId&&x(t=>(0,n.Z)((0,n.Z)({},t),{},{[e.assessmentAnswerId]:s.matchedOptionId})),A({type:s.matchedOptionId?"success":"danger",text:s.matchedOptionId?'AI suggests: "'.concat(s.matchedOptionText,'" \u2014 ').concat(s.reason||""):"AI could not find a reasonable match."})}catch(a){console.error("AI matching failed:",a),A({type:"danger",text:"AI matching failed."})}finally{v(s=>{const t=new Set(s);return t.delete(e.assessmentAnswerId),t})}}})(e),disabled:m||!(null!==(l=e.question)&&void 0!==l&&null!==(c=l.options)&&void 0!==c&&c.length),title:"AI Suggest",children:m?(0,o.jsx)("span",{className:"spinner-border spinner-border-sm"}):"AI Suggest"}),(0,o.jsx)("button",{className:"btn btn-sm btn-light-success",onClick:()=>S(e.assessmentAnswerId),disabled:!d||p||i,children:p?(0,o.jsx)("span",{className:"spinner-border spinner-border-sm"}):i?"Saved":"Save"})]})]},e.assessmentAnswerId)})})]})}):(0,o.jsx)("div",{className:"text-center py-10 text-muted",children:(0,o.jsx)("p",{className:"fs-5",children:"Select an assessment to view text responses."})})]})]})}}}]);
//# sourceMappingURL=15.cd5c7e85.chunk.js.map