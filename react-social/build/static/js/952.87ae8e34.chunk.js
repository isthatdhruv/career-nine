"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[952],{46952:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var o=t(1413),n=(t(45987),t(49142),t(28182)),i=t(72791),a=t(16871),l=t(81724),r=t(34042),c=t(93189),d=t(91591),m=t(94970),u=t(80184);l.Ry().shape({questionText:l.Z_().required("Question text is required"),questionType:l.Z_().required("Question type is required"),sectionId:l.Z_().required("Section is required"),maxOptionsAllowed:l.Rx()});const p=e=>{let{setPageLoading:s}=e;const[t,l]=(0,i.useState)(!1),[p,x]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[b,g]=(0,i.useState)({}),[j,v]=i.useState(!1),y=(0,a.s0)(),[N,q]=(0,i.useState)({}),[w,O]=(0,i.useState)({}),[T,Z]=(0,i.useState)(!1),[k,S]=(0,i.useState)([]),[C,I]=(0,i.useState)(""),E={questionText:"",questionType:"",maxOptionsAllowed:"",questionOptions:[""],sectionId:""},A=()=>{G(e=>{const s=[...e.questionOptions,""];return(0,o.Z)((0,o.Z)({},e),{},{questionOptions:s})})},Q=(e,s)=>{if(s){const t=new FileReader;t.onloadend=()=>{O(s=>(0,o.Z)((0,o.Z)({},s),{},{[e]:t.result}))},t.readAsDataURL(s)}else O(s=>{const t=(0,o.Z)({},s);return delete t[e],t})},[D,G]=(0,i.useState)(E);return(0,i.useEffect)(()=>{(async()=>{try{const e=await(0,r.Bx)();x(e.data)}catch(e){x([])}})()},[]),(0,i.useEffect)(()=>{(async()=>{try{const e=await(0,c.rS)();f(e.data)}catch(e){f([])}})()},[]),(0,i.useEffect)(()=>{(async()=>{try{const e=await(0,m.WL)();S(e.data)}catch(e){S([])}})()},[]),(0,i.useEffect)(()=>{T?(G(e=>(0,o.Z)((0,o.Z)({},e),{},{questionOptions:[]})),g({}),v(!1)):I("")},[T]),(0,i.useEffect)(()=>{j||T||(G(e=>(0,o.Z)((0,o.Z)({},e),{},{questionOptions:[""]})),g({}))},[j]),(0,u.jsx)("div",{className:"container py-5",children:(0,u.jsxs)("div",{className:"card shadow-sm py-5",children:[(0,u.jsx)("div",{className:"card-header",children:(0,u.jsx)("h1",{className:"mb-0",children:"Add Assessment Question"})}),(0,u.jsxs)("form",{className:"form w-100 fv-plugins-bootstrap5 fv-plugins-framework",onSubmit:async e=>{e.preventDefault(),l(!0);try{console.log("Submitting form. optionMeasuredQualities state:",b);let e=[];e=T&&C?[{optionText:null,optionImageBase64:null,optionScores:[],correct:!1,isGame:!0,game:{gameId:Number(C)}}]:D.questionOptions.map((e,s)=>{const t="image"===N[s],o=t?null:"string"===typeof e?e:e.optionText,n=t&&w[s]||null,i="string"!==typeof e&&(e.correct||!1),a="string"===typeof e?null:e.optionDescription||null,l=[];return b[s]&&Object.entries(b[s]).forEach(e=>{let[s,t]=e;t.checked&&l.push({score:t.score,question_option:{},measuredQualityType:{measuredQualityTypeId:Number(s)}})}),{optionText:o,optionImageBase64:n,optionScores:l,correct:i,isGame:!1,game:null,optionDescription:a}});const s={questionText:D.questionText,questionType:D.questionType,maxOptionsAllowed:Number(D.maxOptionsAllowed)||0,options:e,section:{sectionId:Number(D.sectionId)},flag:j?1:0};console.log("Payload to submit:",s),await(0,c.Nj)(s),G(E),g({}),q({}),O({}),I(""),Z(!1),y("/assessment-questions")}catch(s){console.error("Error creating question:",s)}finally{l(!1)}},children:[(0,u.jsxs)("div",{className:"card-body",children:[(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Text:"}),(0,u.jsx)("textarea",{name:"questionText",placeholder:"Enter Question Text",rows:4,className:(0,n.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!D.questionText,"is-valid":!!D.questionText}),value:D.questionText,onChange:e=>G(s=>(0,o.Z)((0,o.Z)({},s),{},{questionText:e.target.value}))})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Question Type:"}),(0,u.jsxs)("select",{name:"questionType",className:(0,n.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!D.questionType,"is-valid":!!D.questionType}),value:D.questionType,onChange:e=>G(s=>(0,o.Z)((0,o.Z)({},s),{},{questionType:e.target.value})),children:[(0,u.jsx)("option",{value:"",children:"Select Question Type"}),(0,u.jsx)("option",{value:"multiple-choice",children:"Multiple Choice"}),(0,u.jsx)("option",{value:"single-choice",children:"Single Choice"}),(0,u.jsx)("option",{value:"ranking",children:"Ranking"})]})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Section"}),(0,u.jsxs)("select",{name:"sectionId",className:(0,n.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!D.sectionId,"is-valid":!!D.sectionId}),value:D.sectionId,onChange:e=>G(s=>(0,o.Z)((0,o.Z)({},s),{},{sectionId:e.target.value})),children:[(0,u.jsx)("option",{value:"",children:"Select Section"}),p.map(e=>(0,u.jsx)("option",{value:e.sectionId,children:e.sectionName},e.sectionId))]})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"required fs-6 fw-bold mb-2",children:"Options:"}),T?(0,u.jsxs)("div",{className:"p-3 border rounded bg-light",children:[(0,u.jsx)("div",{className:"d-flex align-items-center mb-2",children:(0,u.jsx)("span",{className:"me-2 fw-bold",children:"\ud83c\udfae Select Game:"})}),(0,u.jsxs)("select",{className:(0,n.default)("form-control form-control-lg form-control-solid",{"is-invalid text-danger":!C,"is-valid":!!C}),value:C,onChange:e=>I(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"Select a Game"}),k.map(e=>(0,u.jsxs)("option",{value:e.gameId,children:[e.gameName," (Code: ",e.gameCode,")"]},e.gameId))]}),C&&(0,u.jsx)("div",{className:"mt-2 text-success",children:"\u2705 Game selected. This question will launch the selected game as an option."})]}):j?(0,u.jsx)(d.O,{mqt:h,formikValues:D,setFormikValues:G}):D.questionOptions.map((e,s)=>{const t="string"===typeof e?e:e.optionText,i="image"===N[s];return(0,u.jsxs)("div",{className:"mb-3 p-3 border rounded bg-light",children:[(0,u.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,u.jsxs)("span",{className:"me-2 fw-bold",children:["Option ",s+1,":"]}),(0,u.jsxs)("div",{className:"form-check form-switch ms-auto",children:[(0,u.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"option-type-switch-".concat(s),checked:i,onChange:()=>(e=>{q(s=>(0,o.Z)((0,o.Z)({},s),{},{[e]:"image"===s[e]?"text":"image"}))})(s)}),(0,u.jsx)("label",{className:"form-check-label",htmlFor:"option-type-switch-".concat(s),children:i?"\ud83d\udcf7 Image":"\ud83d\udcdd Text"})]})]}),(0,u.jsxs)("div",{className:"d-flex align-items-start gap-2",children:[i?(0,u.jsxs)("div",{className:"flex-grow-1",children:[(0,u.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return Q(s,(null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"form-control form-control-sm mb-2"}),w[s]&&(0,u.jsxs)("div",{className:"position-relative d-inline-block",children:[(0,u.jsx)("img",{src:w[s],alt:"Option ".concat(s+1),style:{maxWidth:150,maxHeight:100,objectFit:"cover",borderRadius:4,border:"1px solid #ddd"}}),(0,u.jsx)("button",{type:"button",className:"btn btn-sm btn-danger position-absolute",style:{top:-8,right:-8,padding:"2px 8px",fontSize:12},onClick:()=>Q(s,null),children:"\xd7"})]})]}):(0,u.jsx)("input",{type:"text",placeholder:"Enter option ".concat(s+1),value:t,onChange:e=>((e,s)=>{G(t=>{const n=[...t.questionOptions];return"string"===typeof n[e]?n[e]=s:n[e]=(0,o.Z)((0,o.Z)({},n[e]),{},{optionText:s}),(0,o.Z)((0,o.Z)({},t),{},{questionOptions:n})})})(s,e.target.value),className:(0,n.default)("form-control form-control-lg form-control-solid flex-grow-1",{"is-invalid text-danger":!t,"is-valid":!!t})}),D.questionOptions.length>1&&(0,u.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>(e=>{G(s=>{const t=s.questionOptions.filter((s,t)=>t!==e);return g(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),q(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),O(s=>{const t={};return Object.keys(s).forEach(o=>{const n=Number(o);n<e?t[n]=s[n]:n>e&&(t[n-1]=s[n])}),t}),(0,o.Z)((0,o.Z)({},s),{},{questionOptions:t})})})(s),children:"-"}),s===D.questionOptions.length-1&&(0,u.jsx)("button",{type:"button",className:"btn btn-sm btn-primary",onClick:A,children:"+"})]}),(0,u.jsxs)("div",{className:"mt-2",children:[(0,u.jsx)("label",{className:"fs-7 fw-semibold mb-1 text-muted",children:"Option Description:"}),(0,u.jsx)("textarea",{className:"form-control form-control-sm",rows:2,placeholder:"Enter description for this option (optional)",value:("string"===typeof e?"":e.optionDescription)||"",onChange:e=>((e,s)=>{G(t=>{const n=[...t.questionOptions],i=n[e];return n[e]="string"===typeof i?{optionText:i,optionDescription:s}:(0,o.Z)((0,o.Z)({},i),{},{optionDescription:s}),(0,o.Z)((0,o.Z)({},t),{},{questionOptions:n})})})(s,e.target.value)})]})]},s)})]}),(0,u.jsxs)("div",{className:"fv-row mb-7",children:[(0,u.jsx)("label",{className:"fs-6 fw-bold mb-2",children:"Max Options Allowed"}),(0,u.jsx)("input",{type:"number",min:0,max:100,value:D.maxOptionsAllowed,onChange:e=>G(s=>(0,o.Z)((0,o.Z)({},s),{},{maxOptionsAllowed:e.target.value})),placeholder:"Max Options Allowed",className:"form-control form-control-lg form-control-solid w-25",style:{width:200}})]}),(0,u.jsxs)("div",{className:"mb-4 d-flex gap-4",children:[(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"checkbox",checked:j,onChange:()=>{v(e=>!e),j||Z(!1)},className:"me-2",disabled:T}),"Use Measured Quality Types as Options"]}),(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"checkbox",checked:T,onChange:()=>{Z(e=>!e),T||v(!1)},className:"me-2",disabled:j}),"\ud83c\udfae Use Game as Option"]})]})]}),(0,u.jsxs)("div",{className:"card-footer d-flex justify-content-end",children:[(0,u.jsx)("button",{type:"button",className:"btn btn-light me-2",onClick:()=>y("/assessment-questions"),children:"Cancel"}),(0,u.jsxs)("button",{type:"submit",className:"btn btn-primary",disabled:t,children:[!t&&(0,u.jsx)("span",{className:"indicator-label",children:"Submit"}),t&&(0,u.jsxs)("span",{className:"indicator-progress",style:{display:"block"},children:["Please wait..."," ",(0,u.jsx)("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})]})})}}}]);
//# sourceMappingURL=952.87ae8e34.chunk.js.map